{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "数据库技术栈升级映射",
  "version": "1.0.0",
  "last_updated": "2025-01-13",
  "mappings": [
    {
      "from": {
        "database": "MySQL",
        "version": "5.7",
        "eol_date": "2023-10-31",
        "status": "end_of_life"
      },
      "to": {
        "database": "MySQL",
        "version": "8.0",
        "release_date": "2018-04-19",
        "eol_date": "2026-04-30"
      },
      "strategy": "required",
      "effort": "medium",
      "duration_weeks": 4,
      "breaking_changes": [
        {
          "category": "认证插件",
          "description": "默认认证插件从 mysql_native_password → caching_sha2_password",
          "impact": "high",
          "solution": "升级客户端驱动或修改用户认证方式",
          "code_example": {
            "alter_user": "ALTER USER 'app_user'@'%' IDENTIFIED WITH mysql_native_password BY 'password';"
          }
        },
        {
          "category": "保留关键字",
          "description": "RANK, SYSTEM 等成为保留关键字",
          "impact": "medium",
          "solution": "使用反引号包裹列名",
          "code_example": {
            "before": "SELECT rank FROM users;",
            "after": "SELECT `rank` FROM users;"
          }
        },
        {
          "category": "SQL Mode",
          "description": "默认启用严格模式（STRICT_TRANS_TABLES）",
          "impact": "high",
          "solution": "修复不符合约束的数据插入",
          "prevention": "在 5.7 中提前启用严格模式测试"
        }
      ],
      "performance_gains": {
        "write_throughput": "+2x",
        "read_performance": "+30%",
        "replication_speed": "+2x"
      },
      "new_features": [
        "窗口函数（ROW_NUMBER, RANK）",
        "CTE（WITH 子句）",
        "JSON 表达式索引",
        "降序索引（DESC）",
        "原子 DDL（不再产生孤儿表）"
      ],
      "migration_path": [
        {
          "step": 1,
          "description": "备份数据（mysqldump）",
          "command": "mysqldump -u root -p --all-databases > backup.sql",
          "duration_hours": 2
        },
        {
          "step": 2,
          "description": "在测试环境升级并验证",
          "duration_days": 5
        },
        {
          "step": 3,
          "description": "生产环境主从切换升级",
          "duration_hours": 4
        }
      ]
    },
    {
      "from": {
        "database": "PostgreSQL",
        "version": "12",
        "eol_date": "2024-11-14",
        "status": "maintenance"
      },
      "to": {
        "database": "PostgreSQL",
        "version": "16",
        "release_date": "2023-09-14",
        "eol_date": "2028-11-09"
      },
      "strategy": "recommended",
      "effort": "low",
      "duration_weeks": 2,
      "breaking_changes": [
        {
          "category": "权限变更",
          "description": "PUBLIC 角色不再默认拥有 CREATE 权限",
          "impact": "medium",
          "solution": "显式授予 CREATE 权限"
        }
      ],
      "performance_gains": {
        "vacuum_speed": "+2x",
        "json_query": "+40%",
        "parallel_query": "+20%"
      },
      "new_features": [
        "增量排序（Incremental Sort）",
        "并行 VACUUM",
        "逻辑复制改进",
        "JSONB 下标访问"
      ]
    },
    {
      "from": {
        "database": "MongoDB",
        "version": "4.4"
      },
      "to": {
        "database": "MongoDB",
        "version": "7.0",
        "release_date": "2023-08-10"
      },
      "strategy": "optional",
      "effort": "low",
      "duration_weeks": 1,
      "new_features": [
        "时序集合改进",
        "加密查询（Queryable Encryption）",
        "Compound Wildcard 索引"
      ]
    }
  ],
  "cross_database_migrations": [
    {
      "from": {
        "database": "MySQL",
        "version": "any"
      },
      "to": {
        "database": "PostgreSQL",
        "version": "16"
      },
      "strategy": "strategic",
      "effort": "very_high",
      "duration_weeks": 24,
      "reasons": [
        "更严格的 ACID 保证",
        "更强大的 JSON/XML 支持",
        "更好的并发控制（MVCC）",
        "更丰富的数据类型"
      ],
      "challenges": [
        {
          "issue": "SQL 方言差异",
          "examples": [
            "LIMIT offset, count → LIMIT count OFFSET offset",
            "NOW() → CURRENT_TIMESTAMP",
            "AUTO_INCREMENT → SERIAL"
          ]
        },
        {
          "issue": "字符串比较大小写敏感性",
          "solution": "使用 ILIKE 或创建 CITEXT 索引"
        }
      ],
      "migration_tools": [
        {
          "name": "pgLoader",
          "purpose": "自动化 MySQL → PostgreSQL 数据迁移",
          "command": "pgloader mysql://user:pass@host/db postgresql://user:pass@host/db"
        }
      ]
    }
  ],
  "tools": [
    {
      "name": "pt-online-schema-change",
      "purpose": "MySQL 在线 DDL（无锁表）",
      "url": "https://www.percona.com/doc/percona-toolkit/",
      "use_case": "大表结构变更"
    },
    {
      "name": "gh-ost",
      "purpose": "GitHub 开源的 MySQL 在线迁移工具",
      "url": "https://github.com/github/gh-ost",
      "use_case": "无停机表迁移"
    },
    {
      "name": "AWS Database Migration Service",
      "purpose": "跨数据库迁移（支持同构和异构）",
      "url": "https://aws.amazon.com/dms/",
      "use_case": "MySQL → PostgreSQL, Oracle → MySQL"
    }
  ],
  "common_pitfalls": [
    {
      "issue": "字符集不匹配",
      "description": "源库 latin1，目标库 utf8mb4",
      "solution": "提前统一字符集，避免乱码",
      "command": "ALTER DATABASE db_name CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
    },
    {
      "issue": "主从延迟",
      "description": "升级期间主从复制延迟增加",
      "solution": "使用并行复制（MySQL 8.0 默认启用）"
    }
  ]
}
