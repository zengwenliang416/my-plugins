# Security Baseline

软件项目安全基线要求，用于风险评估中的安全控制措施核查。

## 1. 安全基线概述

### 1.1 分层安全模型

```
┌─────────────────────────────────────────────────────────┐
│                    应用层安全                            │
│  输入验证 | 认证授权 | 会话管理 | 错误处理 | 日志审计    │
├─────────────────────────────────────────────────────────┤
│                    传输层安全                            │
│         TLS 1.3 | 证书管理 | API 安全                   │
├─────────────────────────────────────────────────────────┤
│                    数据层安全                            │
│       加密存储 | 访问控制 | 备份恢复 | 脱敏处理          │
├─────────────────────────────────────────────────────────┤
│                    基础设施安全                          │
│     网络隔离 | 防火墙 | 入侵检测 | 漏洞管理              │
└─────────────────────────────────────────────────────────┘
```

### 1.2 安全优先级

| 级别 | 标签 | 要求                     | 违规后果     |
| ---- | ---- | ------------------------ | ------------ |
| P0   | 强制 | 必须满足，否则禁止上线   | 阻断发布     |
| P1   | 必要 | 应该满足，需高管审批豁免 | 需要签字豁免 |
| P2   | 建议 | 推荐实施，提升安全水平   | 记录待改进   |
| P3   | 可选 | 视情况实施               | 无           |

## 2. 认证与授权

### 2.1 身份认证 (P0)

| 控制项   | 要求                           | 检查方法 |
| -------- | ------------------------------ | -------- |
| 密码强度 | 最少 12 字符，含大小写数字特殊 | 正则验证 |
| 密码存储 | bcrypt/Argon2，cost >= 12      | 代码审计 |
| 登录限制 | 5 次失败后锁定 15 分钟         | 功能测试 |
| 会话超时 | 闲置 30 分钟后过期             | 配置检查 |
| MFA      | 敏感操作强制开启               | 功能测试 |

### 2.2 授权控制 (P0)

| 控制项    | 要求                         | 检查方法 |
| --------- | ---------------------------- | -------- |
| 最小权限  | 默认拒绝，显式授权           | 代码审计 |
| RBAC/ABAC | 角色或属性基础访问控制       | 设计审查 |
| 水平越权  | 用户只能访问自己的资源       | 渗透测试 |
| 垂直越权  | 低权限用户无法执行高权限操作 | 渗透测试 |
| 权限变更  | 变更需审批，记录日志         | 流程审计 |

### 2.3 会话管理 (P1)

| 控制项     | 要求                         | 检查方法 |
| ---------- | ---------------------------- | -------- |
| Session ID | 256 位随机、HttpOnly、Secure | 配置检查 |
| 会话固定   | 登录后重新生成 Session ID    | 渗透测试 |
| 并发登录   | 可配置单点/多点登录          | 功能测试 |
| 注销处理   | 服务端销毁会话               | 功能测试 |

## 3. 输入验证与输出编码

### 3.1 输入验证 (P0)

| 控制项     | 要求                           | 检查方法        |
| ---------- | ------------------------------ | --------------- |
| 白名单验证 | 验证预期格式，拒绝非预期       | 代码审计        |
| 长度限制   | 所有输入有最大长度限制         | 代码审计        |
| 类型验证   | 强类型验证（TypeScript/Zod）   | 代码审计        |
| 文件上传   | 类型白名单、大小限制、病毒扫描 | 功能测试        |
| SQL 注入   | 参数化查询，禁止拼接           | SAST + 渗透测试 |

### 3.2 输出编码 (P0)

| 控制项          | 要求                       | 检查方法   |
| --------------- | -------------------------- | ---------- |
| HTML 编码       | 动态内容 HTML 实体编码     | 代码审计   |
| JavaScript 编码 | 动态 JS 内容转义           | 代码审计   |
| URL 编码        | URL 参数编码               | 代码审计   |
| CSS 编码        | 动态 CSS 值编码            | 代码审计   |
| CSP             | Content-Security-Policy 头 | 响应头检查 |

### 3.3 防护头部 (P1)

```http
Content-Security-Policy: default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains
Referrer-Policy: strict-origin-when-cross-origin
Permissions-Policy: geolocation=(), microphone=()
```

## 4. 数据保护

### 4.1 传输加密 (P0)

| 控制项     | 要求                      | 检查方法      |
| ---------- | ------------------------- | ------------- |
| TLS 版本   | 仅 TLS 1.2+，推荐 TLS 1.3 | SSL Labs 测试 |
| 证书管理   | 有效期监控、自动续期      | 配置检查      |
| HSTS       | 强制 HTTPS                | 响应头检查    |
| 弱密码套件 | 禁用 MD5、RC4、DES        | 配置检查      |

### 4.2 存储加密 (P1)

| 控制项       | 要求                   | 检查方法 |
| ------------ | ---------------------- | -------- |
| 敏感数据加密 | AES-256-GCM            | 代码审计 |
| 密钥管理     | KMS/HSM 存储，定期轮换 | 配置检查 |
| 密钥分离     | 不同环境使用不同密钥   | 配置检查 |
| 密钥备份     | 安全备份，灾难恢复预案 | 流程审计 |

### 4.3 数据脱敏 (P1)

| 数据类型 | 脱敏规则       | 示例                  |
| -------- | -------------- | --------------------- |
| 手机号   | 中间 4 位掩码  | 138\*\*\*\*5678       |
| 邮箱     | 用户名部分掩码 | a\*\*@example.com     |
| 身份证   | 中间 8 位掩码  | 110****\*\*\*****1234 |
| 银行卡   | 仅显示后 4 位  | ****\*\*\*\*****1234  |
| 姓名     | 姓氏保留       | 张\*\*                |

## 5. 日志与审计

### 5.1 安全日志 (P0)

| 事件类型      | 记录内容               | 保留期限 |
| ------------- | ---------------------- | -------- |
| 登录成功/失败 | 用户、IP、时间、设备   | 1 年     |
| 权限变更      | 操作者、变更内容、时间 | 3 年     |
| 敏感操作      | 操作者、操作类型、目标 | 3 年     |
| 系统异常      | 错误类型、堆栈、上下文 | 90 天    |
| 安全事件      | 攻击类型、来源、处置   | 永久     |

### 5.2 日志安全 (P1)

| 控制项       | 要求               | 检查方法 |
| ------------ | ------------------ | -------- |
| 日志不可篡改 | 追加写入、签名验证 | 配置检查 |
| 敏感信息过滤 | 密码、Token 不记录 | 代码审计 |
| 集中存储     | 日志服务器独立     | 架构审查 |
| 访问控制     | 仅安全团队可访问   | 权限审计 |

### 5.3 监控告警 (P1)

| 告警类型 | 触发条件                    | 响应时间 |
| -------- | --------------------------- | -------- |
| 暴力破解 | 同 IP 10 分钟内失败 > 50 次 | 实时     |
| 异常登录 | 异地、异常时间、新设备      | 5 分钟   |
| 权限提升 | 非管理员执行管理操作        | 实时     |
| 数据泄露 | 大量数据导出、批量查询      | 实时     |

## 6. 错误处理

### 6.1 错误响应 (P0)

| 控制项       | 要求                 | 检查方法 |
| ------------ | -------------------- | -------- |
| 通用错误消息 | 不暴露内部信息       | 功能测试 |
| 堆栈屏蔽     | 生产环境禁止返回堆栈 | 功能测试 |
| 状态码一致   | 认证失败统一 401/403 | API 测试 |
| 错误日志     | 详细记录到后台       | 代码审计 |

### 6.2 错误消息示例

```json
// ❌ 不安全
{
  "error": "User admin not found in database users_table",
  "stack": "Error at /app/src/users/repository.ts:42..."
}

// ✅ 安全
{
  "error": "Invalid credentials",
  "code": "AUTH_FAILED",
  "request_id": "req_abc123"
}
```

## 7. API 安全

### 7.1 API 保护 (P0)

| 控制项   | 要求                          | 检查方法 |
| -------- | ----------------------------- | -------- |
| 认证     | 所有 API 需要认证（公开除外） | API 测试 |
| 限流     | 速率限制防止滥用              | 压力测试 |
| 版本控制 | API 版本化管理                | 设计审查 |
| CORS     | 白名单域名                    | 配置检查 |

### 7.2 限流配置

```yaml
rate_limits:
  default:
    requests_per_second: 100
    burst: 200

  login:
    requests_per_minute: 5
    burst: 10
    by: ip

  sensitive:
    requests_per_minute: 10
    by: user
```

## 8. 依赖安全

### 8.1 依赖管理 (P1)

| 控制项     | 要求                  | 检查方法         |
| ---------- | --------------------- | ---------------- |
| 漏洞扫描   | 定期扫描依赖漏洞      | npm audit / Snyk |
| 版本锁定   | lock 文件提交到仓库   | CI 检查          |
| 许可证审计 | 检查 GPL 等协议兼容性 | license-checker  |
| 私有仓库   | 企业级私有包优先      | 配置检查         |

### 8.2 漏洞响应

| 严重程度 | 响应时间 | 处置方式 |
| -------- | -------- | -------- |
| Critical | 24 小时  | 紧急修复 |
| High     | 7 天     | 优先修复 |
| Medium   | 30 天    | 计划修复 |
| Low      | 下个迭代 | 评估修复 |

## 9. 安全检查清单

### 9.1 代码审查检查点

- [ ] 所有用户输入经过验证
- [ ] 敏感数据已加密存储
- [ ] SQL 查询使用参数化
- [ ] 输出内容已正确编码
- [ ] 错误消息不暴露敏感信息
- [ ] 认证和授权正确实现
- [ ] 敏感操作记录日志
- [ ] 没有硬编码的凭证

### 9.2 部署检查点

- [ ] HTTPS 已配置
- [ ] 安全响应头已设置
- [ ] 调试模式已关闭
- [ ] 默认凭证已更改
- [ ] 不必要的端口已关闭
- [ ] 日志系统已配置
- [ ] 监控告警已设置
- [ ] 备份已验证

## 10. 合规对照

| 标准         | 核心要求                   | 本基线覆盖 |
| ------------ | -------------------------- | ---------- |
| OWASP Top 10 | Web 应用 10 大风险防护     | 第 2-6 节  |
| PCI-DSS      | 支付卡数据安全             | 第 4 节    |
| GDPR         | 个人数据保护               | 第 4.3 节  |
| SOC 2        | 安全性、可用性、处理完整性 | 第 2、5 节 |
| ISO 27001    | 信息安全管理体系           | 全文       |
