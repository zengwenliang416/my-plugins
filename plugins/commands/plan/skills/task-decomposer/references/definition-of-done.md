# Definition of Done (DoD) 完成定义

## 概述

Definition of Done 是团队对"完成"的共识定义。一个任务只有满足所有 DoD 标准才能被标记为完成。

## DoD vs DoR

| 概念 | Definition of Ready (DoR) | Definition of Done (DoD) |
| ---- | ------------------------- | ------------------------ |
| 时机 | 任务开始前                | 任务完成时               |
| 问题 | "任务准备好了吗？"        | "任务真的完成了吗？"     |
| 关注 | 输入质量                  | 输出质量                 |

## 分层 DoD

### Level 1: 任务级 DoD

单个开发任务的完成标准：

```markdown
## 任务完成标准

### 代码质量

- [ ] 代码已提交到版本控制
- [ ] 代码通过 Lint 检查
- [ ] 代码通过类型检查
- [ ] 无新增 TODO/FIXME 未处理

### 测试

- [ ] 单元测试已编写
- [ ] 单元测试通过
- [ ] 测试覆盖率符合要求

### 审查

- [ ] 代码已 Code Review
- [ ] Review 意见已处理

### 文档

- [ ] 代码有必要的注释
- [ ] API 变更已更新文档
```

### Level 2: 功能级 DoD

完整功能的完成标准：

```markdown
## 功能完成标准

### 代码完整性

- [ ] 所有相关任务已完成
- [ ] 前后端集成完成
- [ ] 数据库迁移已执行

### 测试覆盖

- [ ] 集成测试通过
- [ ] E2E 测试通过（核心流程）
- [ ] 边界情况已测试

### 质量保证

- [ ] 无 P0/P1 Bug
- [ ] 性能符合要求
- [ ] 安全扫描通过

### 文档和沟通

- [ ] 用户文档已更新
- [ ] Release Notes 已编写
- [ ] 相关方已通知
```

### Level 3: 发布级 DoD

版本发布的完成标准：

```markdown
## 发布完成标准

### 质量门禁

- [ ] 所有功能级 DoD 已满足
- [ ] 回归测试通过
- [ ] 性能测试通过
- [ ] 安全审计通过

### 部署准备

- [ ] 配置已就绪
- [ ] 数据迁移脚本已验证
- [ ] 回滚方案已准备
- [ ] 监控告警已配置

### 文档和培训

- [ ] 发布文档完整
- [ ] 运维文档更新
- [ ] 培训材料就绪（如需）

### 审批

- [ ] 产品验收通过
- [ ] 发布审批完成
```

## 任务类型 DoD

### 后端任务 DoD

```markdown
## 后端任务完成标准

### 代码

- [ ] API 实现符合接口契约
- [ ] 输入验证完整
- [ ] 错误处理恰当
- [ ] 日志记录充分

### 数据

- [ ] 数据库迁移脚本编写
- [ ] 迁移可重复执行
- [ ] 回滚脚本准备

### 安全

- [ ] 无 SQL 注入风险
- [ ] 认证/授权正确
- [ ] 敏感数据加密

### 测试

- [ ] 单元测试 > 80%
- [ ] API 测试覆盖
- [ ] 异常路径测试
```

### 前端任务 DoD

```markdown
## 前端任务完成标准

### 代码

- [ ] 组件实现完整
- [ ] TypeScript 类型完整
- [ ] 无控制台错误

### UI/UX

- [ ] 符合设计稿
- [ ] 响应式适配
- [ ] 加载状态处理
- [ ] 错误状态处理
- [ ] 空状态处理

### 可访问性

- [ ] 键盘导航支持
- [ ] 屏幕阅读器友好
- [ ] 颜色对比度符合 WCAG

### 测试

- [ ] 组件测试编写
- [ ] 交互测试覆盖
- [ ] 跨浏览器验证
```

### 基础设施任务 DoD

```markdown
## 基础设施任务完成标准

### 配置

- [ ] 配置文件版本化
- [ ] 环境变量文档化
- [ ] 密钥安全存储

### 部署

- [ ] CI/CD 流水线更新
- [ ] 部署脚本测试
- [ ] 环境隔离验证

### 监控

- [ ] 指标采集配置
- [ ] 告警规则设置
- [ ] 日志收集验证

### 文档

- [ ] 架构图更新
- [ ] 运维手册更新
- [ ] 故障排查指南
```

## DoD 检查矩阵

### 通用检查项

| 检查项      | 任务级 | 功能级 | 发布级 |
| ----------- | ------ | ------ | ------ |
| 代码提交    | ✅     | ✅     | ✅     |
| Lint 通过   | ✅     | ✅     | ✅     |
| 单元测试    | ✅     | ✅     | ✅     |
| Code Review | ✅     | ✅     | ✅     |
| 集成测试    | -      | ✅     | ✅     |
| E2E 测试    | -      | ✅     | ✅     |
| 性能测试    | -      | -      | ✅     |
| 安全审计    | -      | -      | ✅     |
| 文档更新    | 按需   | ✅     | ✅     |
| 产品验收    | -      | ✅     | ✅     |

### 测试覆盖率标准

| 代码类型 | 最低覆盖率 | 推荐覆盖率 |
| -------- | ---------- | ---------- |
| 业务逻辑 | 80%        | 90%        |
| 工具函数 | 90%        | 95%        |
| UI 组件  | 70%        | 80%        |
| 集成代码 | 60%        | 70%        |

## DoD 验证流程

### 自动化检查

```yaml
# CI/CD Pipeline DoD Gates
stages:
  - lint
  - test
  - security
  - deploy

lint:
  script:
    - npm run lint
    - npm run type-check
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"

test:
  script:
    - npm run test:coverage
  coverage: '/Statements\s*:\s*(\d+\.?\d*)%/'
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"

security:
  script:
    - npm audit --audit-level=high
    - npm run security-scan
  rules:
    - if: $CI_COMMIT_BRANCH == "main"
```

### 人工检查清单

```markdown
## PR Review Checklist

### 代码质量

- [ ] 代码可读性良好
- [ ] 无明显性能问题
- [ ] 无重复代码

### 功能完整性

- [ ] 需求已完整实现
- [ ] 边界情况已处理
- [ ] 错误处理恰当

### 测试充分性

- [ ] 测试用例覆盖主要场景
- [ ] 测试用例可维护
- [ ] Mock 使用合理

### 安全性

- [ ] 无敏感信息泄露
- [ ] 输入验证充分
- [ ] 权限控制正确
```

## DoD 持续改进

### 回顾会议议题

1. 哪些 DoD 项经常被跳过？
2. 哪些 DoD 项应该加强？
3. 哪些 DoD 项可以自动化？
4. DoD 是否与实际交付质量匹配？

### 指标追踪

| 指标         | 计算方式                    | 目标  |
| ------------ | --------------------------- | ----- |
| DoD 完成率   | 满足 DoD 的任务 / 总任务    | > 95% |
| 返工率       | 重新打开的任务 / 已关闭任务 | < 5%  |
| 逃逸缺陷率   | 生产 Bug / 发布功能数       | < 2%  |
| 自动化覆盖率 | 自动化检查项 / 总检查项     | > 70% |

## DoD 模板

### 标准任务 DoD 模板

```markdown
# DoD - [任务名称]

## 基本信息

- 任务 ID: T-XXX
- 类型: [backend/frontend/infra]
- 负责人: [姓名]

## 完成检查

### 代码 [必选]

- [ ] 代码已提交
- [ ] 通过 CI 检查
- [ ] Code Review 完成

### 测试 [必选]

- [ ] 单元测试编写
- [ ] 测试通过
- [ ] 覆盖率 >= X%

### 文档 [按需]

- [ ] 代码注释
- [ ] API 文档
- [ ] 使用说明

### 验收

- [ ] 自测通过
- [ ] 产品验收（如需）

## 备注

[任何特殊说明]

## 签字

- 开发: **\_\_\_** 日期: **\_\_\_**
- 审核: **\_\_\_** 日期: **\_\_\_**
```
