---
name: architecture-analyzer
description: |
  ã€è§¦å‘æ¡ä»¶ã€‘plan å·¥ä½œæµç¬¬å››æ­¥ï¼šæ•´åˆå¤šæ¨¡å‹è§„åˆ’ç»“æœï¼Œç”Ÿæˆç»Ÿä¸€æ¶æ„æ–‡æ¡£
  ã€æ ¸å¿ƒäº§å‡ºã€‘è¾“å‡º ${run_dir}/architecture.mdï¼ˆæ•´åˆåç«¯ + å‰ç«¯è§„åˆ’ï¼‰
  ã€å¼ºåˆ¶å‰ç½®ã€‘å¿…é¡»å…ˆæ‰§è¡Œ codex-planner å’Œ/æˆ– gemini-planner
  ã€å¹¶è¡Œæ”¯æŒã€‘âœ… è¯»å– codex-plan.mdï¼ˆåç«¯ï¼‰+ gemini-plan.mdï¼ˆå‰ç«¯ï¼‰
allowed-tools:
  - Read
  - Write
  - Skill
arguments:
  - name: run_dir
    type: string
    required: true
    description: è¿è¡Œç›®å½•è·¯å¾„ï¼ˆç”± orchestrator ä¼ å…¥ï¼‰
  - name: task_type
    type: string
    required: false
    description: ä»»åŠ¡ç±»å‹ï¼ˆfullstack|frontend|backendï¼‰ï¼Œé»˜è®¤ fullstack
---

# Architecture Analyzer - æ¶æ„æ•´åˆåŸå­æŠ€èƒ½

## èŒè´£è¾¹ç•Œ

- **è¾“å…¥**:
  - `${run_dir}/requirements.md`
  - `${run_dir}/context.md`
  - `${run_dir}/codex-plan.md`ï¼ˆåç«¯è§„åˆ’ï¼Œæ¥è‡ª codex-plannerï¼‰
  - `${run_dir}/gemini-plan.md`ï¼ˆå‰ç«¯è§„åˆ’ï¼Œæ¥è‡ª gemini-plannerï¼‰
- **è¾“å‡º**: `${run_dir}/architecture.md`ï¼ˆæ•´åˆåçš„ç»Ÿä¸€æ¶æ„æ–‡æ¡£ï¼‰
- **å•ä¸€èŒè´£**: åªåšæ¶æ„æ•´åˆï¼Œä¸åšåŸå§‹åˆ†æ

## ğŸš¨ğŸš¨ğŸš¨ å¼ºåˆ¶è§„åˆ™ ğŸš¨ğŸš¨ğŸš¨

**æœ¬ Skill è´Ÿè´£æ•´åˆï¼ŒåŸå§‹åˆ†æç”± planner skills å®Œæˆï¼**

- âœ… æ­£ç¡®æµç¨‹ï¼šå…ˆè°ƒç”¨ codex-planner/gemini-planner â†’ å†è°ƒç”¨ architecture-analyzer
- âŒ ç¦æ­¢ï¼šè·³è¿‡ planner skills ç›´æ¥åˆ†æ
- âŒ ç¦æ­¢ï¼šClaude è‡ªå·±å†™æ¶æ„åˆ†ææ›¿ä»£ planner è¾“å‡º

## åä½œæµç¨‹

```
plan-context-retriever â†’ codex-planner (åç«¯) â”€â”
                                              â”œâ†’ architecture-analyzer â†’ task-decomposer
                       â†’ gemini-planner (å‰ç«¯) â”€â”˜
```

## æ‰§è¡Œæµç¨‹

### Step 1: éªŒè¯å‰ç½®æ¡ä»¶

æ£€æŸ¥ planner è¾“å‡ºæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š

```bash
# æ ¹æ® task_type æ£€æŸ¥å¿…è¦æ–‡ä»¶
if [[ "$TASK_TYPE" == "fullstack" || "$TASK_TYPE" == "backend" ]]; then
  if [[ ! -f "${run_dir}/codex-plan.md" ]]; then
    echo "é”™è¯¯ï¼šç¼ºå°‘ codex-plan.mdï¼Œè¯·å…ˆæ‰§è¡Œ plan:codex-planner"
    exit 1
  fi
fi

if [[ "$TASK_TYPE" == "fullstack" || "$TASK_TYPE" == "frontend" ]]; then
  if [[ ! -f "${run_dir}/gemini-plan.md" ]]; then
    echo "é”™è¯¯ï¼šç¼ºå°‘ gemini-plan.mdï¼Œè¯·å…ˆæ‰§è¡Œ plan:gemini-planner"
    exit 1
  fi
fi
```

### Step 2: è¯»å–æ‰€æœ‰è¾“å…¥

```bash
REQUIREMENTS=$(cat "${run_dir}/requirements.md")
CONTEXT=$(cat "${run_dir}/context.md")

# æ ¹æ® task_type è¯»å– planner è¾“å‡º
if [[ -f "${run_dir}/codex-plan.md" ]]; then
  CODEX_PLAN=$(cat "${run_dir}/codex-plan.md")
fi

if [[ -f "${run_dir}/gemini-plan.md" ]]; then
  GEMINI_PLAN=$(cat "${run_dir}/gemini-plan.md")
fi
```

### Step 3: æ•´åˆæ¨¡å¼

| ä»»åŠ¡ç±»å‹  | æ•´åˆæ¨¡å¼     | è¾“å…¥æ¥æº                       |
| --------- | ------------ | ------------------------------ |
| fullstack | åŒè§„åˆ’æ•´åˆ   | codex-plan.md + gemini-plan.md |
| backend   | åç«¯è§„åˆ’ä¸ºä¸» | codex-plan.md                  |
| frontend  | å‰ç«¯è§„åˆ’ä¸ºä¸» | gemini-plan.md                 |

### Step 4: æ•´åˆåˆ†æç»“æœ

Claude è´Ÿè´£å°†ä¸¤ä¸ª planner çš„è¾“å‡ºæ•´åˆä¸ºç»Ÿä¸€æ¶æ„æ–‡æ¡£ï¼š

1. **æå–åç«¯æ¶æ„**ï¼ˆä» codex-plan.mdï¼‰
   - API è®¾è®¡
   - æ•°æ®æ¨¡å‹
   - å®‰å…¨ç­–ç•¥
   - æ€§èƒ½è€ƒé‡
   - å®æ–½è·¯å¾„

2. **æå–å‰ç«¯æ¶æ„**ï¼ˆä» gemini-plan.mdï¼‰
   - ç»„ä»¶æ¶æ„ï¼ˆAtomic Designï¼‰
   - çŠ¶æ€ç®¡ç†
   - è·¯ç”±è®¾è®¡
   - å“åº”å¼ç­–ç•¥
   - æ— éšœç¢æ¸…å•

3. **è¯†åˆ«äº¤å‰ç‚¹**
   - API å¥‘çº¦ï¼ˆå‰åç«¯å…±äº«ï¼‰
   - è®¤è¯æµç¨‹ï¼ˆToken ä¼ é€’ï¼‰
   - æ•°æ®æ ¼å¼ï¼ˆDTO å®šä¹‰ï¼‰
   - é”™è¯¯å¤„ç†ï¼ˆé”™è¯¯ç æ˜ å°„ï¼‰

4. **æ¶ˆé™¤å†²çª**
   - å¦‚æœä¸¤ä¸ª planner æœ‰ä¸åŒå»ºè®®ï¼Œè®°å½•ä¸º ADR

### Step 5: æ¶æ„å†³ç­–è®°å½•

å¯¹äºå…³é”®å†³ç­–ï¼Œç”Ÿæˆ ADRï¼ˆArchitecture Decision Recordï¼‰ï¼š

```markdown
### ADR-001: è®¤è¯æ–¹æ¡ˆé€‰æ‹©

**çŠ¶æ€**: å·²å†³å®š

**ä¸Šä¸‹æ–‡**: éœ€è¦å®ç°ç”¨æˆ·è®¤è¯åŠŸèƒ½

**å†³ç­–**: ä½¿ç”¨ JWT + OAuth2

**ç†ç”±**:

- è¡Œä¸šæ ‡å‡†æ–¹æ¡ˆ
- æ”¯æŒæ— çŠ¶æ€è®¤è¯
- æ˜“äºé›†æˆç¬¬ä¸‰æ–¹ç™»å½•

**åæœ**:

- éœ€è¦å®ç° token åˆ·æ–°æœºåˆ¶
- éœ€è¦å®‰å…¨å­˜å‚¨ secret
```

### Step 6: ç»“æ„åŒ–è¾“å‡º

å°†åˆ†æç»“æœå†™å…¥ `${run_dir}/architecture.md`ï¼š

````markdown
# æ¶æ„è®¾è®¡

## å…ƒä¿¡æ¯

- åˆ†ææ—¶é—´: [timestamp]
- åˆ†ææ¨¡å‹: [codex|gemini|both]
- ä»»åŠ¡ç±»å‹: [frontend|backend|fullstack]

## æ¶æ„æ¦‚è¿°

[ä¸€æ®µè¯æè¿°æ•´ä½“æ¶æ„æ–¹æ¡ˆ]

## åç«¯æ¶æ„ï¼ˆCodex åˆ†æï¼‰

### API è®¾è®¡

| ç«¯ç‚¹               | æ–¹æ³• | æè¿°     | è¯·æ±‚ä½“                  | å“åº”          |
| ------------------ | ---- | -------- | ----------------------- | ------------- |
| /api/auth/login    | POST | ç”¨æˆ·ç™»å½• | {email, password}       | {token, user} |
| /api/auth/register | POST | ç”¨æˆ·æ³¨å†Œ | {email, password, name} | {user}        |

### æ•°æ®æ¨¡å‹

```typescript
interface User {
  id: string;
  email: string;
  passwordHash: string;
  role: "admin" | "user";
  createdAt: Date;
  updatedAt: Date;
}
```
````

### ä¸šåŠ¡é€»è¾‘å±‚

```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ auth.service.ts      # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ user.service.ts      # ç”¨æˆ·æœåŠ¡
â”‚   â””â”€â”€ token.service.ts     # Token ç®¡ç†
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ auth.controller.ts   # è®¤è¯æ§åˆ¶å™¨
â””â”€â”€ middleware/
    â””â”€â”€ auth.middleware.ts   # è®¤è¯ä¸­é—´ä»¶
```

### å®‰å…¨ç­–ç•¥

- JWT éªŒè¯ä¸­é—´ä»¶
- å¯†ç  bcrypt å“ˆå¸Œ
- Rate limiting (100 req/min)
- è¾“å…¥éªŒè¯ (Zod schema)

## å‰ç«¯æ¶æ„ï¼ˆGemini åˆ†æï¼‰

### ç»„ä»¶ç»“æ„

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ atoms/
â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â””â”€â”€ Label.tsx
â”‚   â”œâ”€â”€ molecules/
â”‚   â”‚   â”œâ”€â”€ FormField.tsx
â”‚   â”‚   â””â”€â”€ Alert.tsx
â”‚   â””â”€â”€ organisms/
â”‚       â”œâ”€â”€ LoginForm.tsx
â”‚       â””â”€â”€ RegisterForm.tsx
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Login.tsx
â”‚   â””â”€â”€ Register.tsx
â””â”€â”€ contexts/
    â””â”€â”€ AuthContext.tsx
```

### çŠ¶æ€ç®¡ç†

| çŠ¶æ€ç±»å‹       | æ–¹æ¡ˆ        | ç”¨é€”           |
| -------------- | ----------- | -------------- |
| æœåŠ¡å™¨çŠ¶æ€     | React Query | API æ•°æ®ç¼“å­˜   |
| å…¨å±€å®¢æˆ·ç«¯çŠ¶æ€ | Zustand     | ç”¨æˆ·ä¼šè¯       |
| UI çŠ¶æ€        | useState    | è¡¨å•ã€åŠ è½½çŠ¶æ€ |

### è·¯ç”±è®¾è®¡

```
/                    â†’ é‡å®šå‘åˆ° /login æˆ– /dashboard
/login              â†’ LoginPage
/register           â†’ RegisterPage
/dashboard          â†’ DashboardPage (éœ€è®¤è¯)
```

### æ ·å¼æ–¹æ¡ˆ

- CSS-in-JS: Tailwind CSS
- è®¾è®¡ç³»ç»Ÿ: è‡ªå®šä¹‰ä¸»é¢˜å˜é‡
- å“åº”å¼æ–­ç‚¹: sm(640px), md(768px), lg(1024px)

## æ¨ªåˆ‡å…³æ³¨ç‚¹

### é”™è¯¯å¤„ç†

- ç»Ÿä¸€é”™è¯¯æ ¼å¼
- é”™è¯¯è¾¹ç•Œç»„ä»¶
- ç”¨æˆ·å‹å¥½é”™è¯¯æ¶ˆæ¯

### æ—¥å¿—ä¸ç›‘æ§

- ç»“æ„åŒ–æ—¥å¿— (Winston)
- è¯·æ±‚è¿½è¸ª (correlation ID)

### æµ‹è¯•ç­–ç•¥

- å•å…ƒæµ‹è¯•: Jest
- é›†æˆæµ‹è¯•: Supertest
- E2E æµ‹è¯•: Playwright

## æ¶æ„å†³ç­–è®°å½•

### ADR-001: [å†³ç­–æ ‡é¢˜]

[ADR å†…å®¹]

## è´¨é‡å±æ€§

| å±æ€§   | ç›®æ ‡         | éªŒè¯æ–¹å¼ |
| ------ | ------------ | -------- |
| æ€§èƒ½   | API < 200ms  | è´Ÿè½½æµ‹è¯• |
| å¯ç”¨æ€§ | 99.9%        | å¥åº·æ£€æŸ¥ |
| å®‰å…¨æ€§ | OWASP Top 10 | å®‰å…¨æ‰«æ |

---

ä¸‹ä¸€æ­¥: è°ƒç”¨ task-decomposer è¿›è¡Œä»»åŠ¡åˆ†è§£

```

## è¿”å›å€¼

æ‰§è¡Œå®Œæˆåï¼Œè¿”å›ï¼š

```

æ¶æ„åˆ†æå®Œæˆã€‚
è¾“å‡ºæ–‡ä»¶: ${run_dir}/architecture.md
åˆ†ææ¨¡å‹: [codex|gemini|both]
API ç«¯ç‚¹: X ä¸ª
ç»„ä»¶æ•°é‡: Y ä¸ª
æ¶æ„å†³ç­–: Z ä¸ª

ä¸‹ä¸€æ­¥: ä½¿ç”¨ plan:task-decomposer è¿›è¡Œä»»åŠ¡åˆ†è§£

```

## è´¨é‡é—¨æ§

- âœ… éªŒè¯äº† planner è¾“å‡ºæ–‡ä»¶å­˜åœ¨
- âœ… è¦†ç›–äº† arc42 å…³é”®ç« èŠ‚
- âœ… æ•´åˆäº†å‰åç«¯æ¶æ„
- âœ… è®°å½•äº†æ¶æ„å†³ç­–ï¼ˆADRï¼‰
- âœ… å®šä¹‰äº†è´¨é‡å±æ€§ç›®æ ‡
- âœ… è¯†åˆ«äº†å‰åç«¯äº¤å‰ç‚¹

## çº¦æŸ

| å¿…é¡»æ‰§è¡Œ                        | ç¦æ­¢äº‹é¡¹                    |
| ------------------------------- | --------------------------- |
| âœ… éªŒè¯ planner è¾“å‡ºæ–‡ä»¶å­˜åœ¨    | âŒ è·³è¿‡ planner ç›´æ¥åˆ†æ    |
| âœ… æ•´åˆä¸¤ä¸ª planner çš„è¾“å‡º      | âŒ åªå–ä¸€ä¸ª planner çš„ç»“æœ  |
| âœ… è®°å½•å†²çªå’Œå†³ç­–               | âŒ å¿½ç•¥å‰åç«¯å†²çª           |
| âœ… è¾“å‡ºç»Ÿä¸€çš„ architecture.md   | âŒ äº§å‡ºå¤šä¸ªåˆ†æ•£çš„æ–‡ä»¶       |
| âœ… è¯†åˆ« API å¥‘çº¦å’Œäº¤å‰å…³æ³¨ç‚¹    | âŒ å‰åç«¯å®Œå…¨ç‹¬ç«‹ä¸å…³è”     |

## ä¸ Planner Skills çš„å…³ç³»

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ plan å·¥ä½œæµ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 3a: codex-planner â”‚
â”‚ è¾“å…¥: requirements.md, context.md â”‚
â”‚ è¾“å‡º: codex-plan.md (PLANS.md æ ¼å¼) â”‚
â”‚ å†…å®¹: åç«¯æ¶æ„ã€APIã€æ•°æ®æ¨¡å‹ã€å®‰å…¨ç­–ç•¥ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 3b: gemini-planner (å¹¶è¡Œ) â”‚
â”‚ è¾“å…¥: requirements.md, context.md â”‚
â”‚ è¾“å‡º: gemini-plan.md (SPEC.md æ ¼å¼) â”‚
â”‚ å†…å®¹: å‰ç«¯æ¶æ„ã€ç»„ä»¶ã€çŠ¶æ€ã€è·¯ç”±ã€å“åº”å¼ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 4: architecture-analyzer â”‚
â”‚ è¾“å…¥: codex-plan.md + gemini-plan.md â”‚
â”‚ è¾“å‡º: architecture.md (ç»Ÿä¸€æ ¼å¼) â”‚
â”‚ èŒè´£: æ•´åˆã€å»é‡ã€æ¶ˆé™¤å†²çªã€è¯†åˆ«äº¤å‰ç‚¹ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

```
