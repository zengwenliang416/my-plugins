# Plan Standard

计划输出标准，定义最终 plan.md 的结构和质量要求。

## 1. 计划文档结构

### 1.1 必要章节

```
plan.md
├── 元信息
│   ├── 规划 ID
│   ├── 任务类型
│   ├── 创建时间
│   └── 输入摘要
├── 执行摘要
│   ├── 目标概述
│   ├── 关键决策
│   └── 风险预警
├── 需求规格
│   ├── 功能需求摘要
│   ├── 非功能需求摘要
│   └── 约束条件
├── 架构设计
│   ├── 技术方案
│   ├── 组件结构
│   └── 关键决策
├── 实施路线图
│   ├── 阶段划分
│   ├── 任务清单
│   └── 关键路径
├── 风险与缓解
│   ├── 高优先级风险
│   └── 缓解计划
├── 验收标准
│   ├── 功能验收
│   ├── 质量验收
│   └── 交付物清单
└── 后续操作
    └── dev 命令引导
```

### 1.2 可选章节

- 资源需求
- 沟通计划
- 变更管理
- 附录

## 2. 章节内容规范

### 2.1 元信息

| 字段     | 格式                       | 示例              |
| -------- | -------------------------- | ----------------- |
| 规划 ID  | ISO 8601 时间戳            | 20260119T100000Z  |
| 任务类型 | frontend/backend/fullstack | fullstack         |
| 输入摘要 | 原始需求的精简版           | 实现 JWT 用户认证 |
| 产物链接 | 相对路径                   | ./requirements.md |

### 2.2 执行摘要

**目标**：一句话描述项目目标

**范围**：

- 包含：明确列出
- 不包含：明确排除

**关键决策**：

1. 技术选型决策
2. 架构模式决策
3. 实施策略决策

**风险预警**：列出 Critical/High 级别风险

### 2.3 实施路线图

**阶段划分原则**：

- 阶段 1：基础设施（无依赖）
- 阶段 2：核心功能（依赖阶段 1）
- 阶段 3：集成测试（依赖阶段 2）
- 阶段 4：优化收尾（依赖阶段 3）

**任务清单格式**：

| ID  | 任务 | 类型 | 复杂度 | 依赖 | 验收标准 |
| --- | ---- | ---- | ------ | ---- | -------- |

### 2.4 验收标准

**功能验收**：

- [ ] 具体可测试的功能点

**质量验收**：

- [ ] 测试覆盖率 >= X%
- [ ] 无 Critical/High 安全漏洞
- [ ] 性能指标达标

**交付物清单**：

- 代码文件列表
- 文档更新列表
- 配置变更列表

## 3. 质量检查清单

### 3.1 完整性检查

- [ ] 所有必要章节均已填写
- [ ] 每个需求都有对应任务
- [ ] 每个任务都有验收标准
- [ ] 所有高风险都有缓解计划

### 3.2 一致性检查

- [ ] 任务 ID 与 tasks.md 一致
- [ ] 风险 ID 与 risks.md 一致
- [ ] 架构描述与 architecture.md 一致
- [ ] 需求引用与 requirements.md 一致

### 3.3 可执行性检查

- [ ] 任务粒度适中（1-4 小时）
- [ ] 依赖关系清晰无环
- [ ] 验收标准可量化
- [ ] 后续操作命令可直接执行

### 3.4 可追溯性检查

- [ ] 需求 → 任务 → 测试 可追溯
- [ ] 决策有记录和理由
- [ ] 证据链完整

## 4. 输出格式

### 4.1 Markdown 规范

- 使用标准 GitHub Flavored Markdown
- 表格对齐
- 代码块标注语言
- 链接使用相对路径

### 4.2 命名规范

```
.claude/planning/runs/{plan_id}/
├── plan.md           # 主计划文档
├── requirements.md   # 需求规格
├── context.md        # 上下文检索
├── architecture.md   # 架构设计
├── tasks.md          # 任务分解
├── risks.md          # 风险评估
└── state.json        # 工作流状态
```

### 4.3 交叉引用格式

```markdown
<!-- 引用需求 -->

详见 [FR-001](./requirements.md#fr-001-用户认证)

<!-- 引用任务 -->

关键路径：[T-001](./tasks.md#t-001) → [T-002](./tasks.md#t-002)

<!-- 引用风险 -->

需关注 [R-001](./risks.md#r-001-数据库迁移风险)
```

## 5. 与 dev 衔接

### 5.1 衔接命令

```bash
# 执行规划
/dev --plan-id={plan_id}

# 执行规划（指定阶段）
/dev --plan-id={plan_id} --phase=1

# 执行规划（指定任务）
/dev --plan-id={plan_id} --task=T-001
```

### 5.2 状态传递

plan.md 中包含的元数据会传递给 dev：

```yaml
---
plan_id: 20260119T100000Z
task_type: fullstack
total_tasks: 12
critical_risks: 2
estimated_effort: 8h
---
```

### 5.3 上下文复用

dev 工作流可复用 plan 产出：

| plan 产出       | dev 使用方式            |
| --------------- | ----------------------- |
| context.md      | 跳过 context-retriever  |
| architecture.md | 作为 analyzer 输入      |
| tasks.md        | 生成 TodoWrite 任务列表 |
| risks.md        | 安全审查参考            |

## 6. 版本控制

### 6.1 版本号规则

- 初始版本：v1.0
- 小修改：v1.1, v1.2, ...
- 重大变更：v2.0, v3.0, ...

### 6.2 变更记录

每次更新需在附录记录：

| 版本 | 日期 | 变更内容 | 变更人 |
| ---- | ---- | -------- | ------ |

### 6.3 归档策略

- 保留最新版本和前一版本
- 重大变更版本永久保留
- 完成的规划移至 archive/
