# Git Safety Reference

Git æäº¤å®‰å…¨æ£€æŸ¥æ¸…å•å’Œé”™è¯¯å¤„ç†æŒ‡å—ã€‚

---

## 1. å®‰å…¨æ£€æŸ¥æ¸…å•

### 1.1 æäº¤å‰æ£€æŸ¥

| æ£€æŸ¥é¡¹ | è¯´æ˜ | ä¸¥é‡æ€§ |
|--------|------|--------|
| æ•æ„Ÿæ–‡ä»¶ | æ£€æŸ¥ .env, credentials, keys | ğŸ”´ Critical |
| å¤§æ–‡ä»¶ | æ£€æŸ¥ >10MB æ–‡ä»¶ | ğŸŸ¡ Warning |
| äºŒè¿›åˆ¶æ–‡ä»¶ | æ£€æŸ¥æ„å¤–çš„äºŒè¿›åˆ¶æ–‡ä»¶ | ğŸŸ¡ Warning |
| åˆå¹¶å†²çªæ ‡è®° | æ£€æŸ¥ `<<<<<<<` ç­‰æ ‡è®° | ğŸ”´ Critical |
| TODO/FIXME | æ£€æŸ¥æœªå®Œæˆçš„æ ‡è®° | ğŸŸ¢ Info |
| Console.log | æ£€æŸ¥è°ƒè¯•ä»£ç  | ğŸŸ¡ Warning |

### 1.2 æ•æ„Ÿæ–‡ä»¶æ¨¡å¼

```
# ç»å¯¹ä¸èƒ½æäº¤
.env
.env.*
*.pem
*.key
*_rsa
credentials.json
secrets.yaml
.aws/credentials
.gcloud/
*.p12
*.pfx

# éœ€è¦è­¦å‘Š
config.local.*
*.local.json
*secret*
*password*
*token*
```

---

## 2. Pre-commit Hook å¤„ç†

### 2.1 å¸¸è§ Hook ç±»å‹

| Hook | ç”¨é€” | å¤±è´¥å¤„ç† |
|------|------|----------|
| `pre-commit` | ä»£ç æ£€æŸ¥ | ä¿®å¤é—®é¢˜æˆ–è·³è¿‡ |
| `commit-msg` | æ¶ˆæ¯æ ¼å¼éªŒè¯ | è°ƒæ•´æ¶ˆæ¯æ ¼å¼ |
| `prepare-commit-msg` | æ¶ˆæ¯æ¨¡æ¿ | é€šå¸¸ä¸å¤±è´¥ |

### 2.2 Hook å¤±è´¥å¤„ç†æµç¨‹

```
Hook å¤±è´¥
    â†“
åˆ†æé”™è¯¯ç±»å‹
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lint é”™è¯¯       â”‚ æ ¼å¼é”™è¯¯          â”‚
â”‚                 â”‚                  â”‚
â”‚ â†’ è‡ªåŠ¨ä¿®å¤      â”‚ â†’ è°ƒæ•´æ¶ˆæ¯æ ¼å¼    â”‚
â”‚   npm run lint  â”‚                  â”‚
â”‚   --fix         â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
é‡æ–°æäº¤
    â†“
ä»ç„¶å¤±è´¥ï¼Ÿâ†’ è¯¢é—®ç”¨æˆ·æ˜¯å¦è·³è¿‡
```

### 2.3 è·³è¿‡ Hook é€‰é¡¹

```bash
# è·³è¿‡æ‰€æœ‰ hooks
git commit --no-verify

# è·³è¿‡ç‰¹å®š hook (éœ€è¦è‡ªå®šä¹‰é…ç½®)
SKIP=eslint git commit
```

**è­¦å‘Š**: è·³è¿‡ hooks åº”è¯¥æ˜¯æœ€åæ‰‹æ®µï¼Œéœ€è¦ç”¨æˆ·æ˜ç¡®ç¡®è®¤ã€‚

---

## 3. é”™è¯¯å¤„ç†

### 3.1 å¸¸è§é”™è¯¯åŠè§£å†³

| é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| `nothing to commit` | æš‚å­˜åŒºä¸ºç©º | å…ˆæ‰§è¡Œ `git add` |
| `Changes not staged` | æœ‰æœªæš‚å­˜çš„ä¿®æ”¹ | æš‚å­˜æˆ–å¿½ç•¥ |
| `commit message empty` | æ¶ˆæ¯ä¸ºç©º | æä¾›æœ‰æ•ˆæ¶ˆæ¯ |
| `hook failed` | Pre-commit å¤±è´¥ | ä¿®å¤é—®é¢˜æˆ–è·³è¿‡ |
| `detached HEAD` | ä¸åœ¨åˆ†æ”¯ä¸Š | åˆ›å»ºæˆ–åˆ‡æ¢åˆ†æ”¯ |
| `merge conflict` | å­˜åœ¨å†²çª | è§£å†³å†²çªåæäº¤ |

### 3.2 é”™è¯¯ä»£ç æ˜ å°„

| é€€å‡ºç  | å«ä¹‰ |
|--------|------|
| 0 | æˆåŠŸ |
| 1 | ä¸€èˆ¬é”™è¯¯ |
| 128 | Git ä»“åº“é”™è¯¯ |

---

## 4. æäº¤ç­–ç•¥

### 4.1 åŸå­æäº¤åŸåˆ™

```
âœ… å¥½çš„æäº¤
- ä¸€ä¸ªæäº¤è§£å†³ä¸€ä¸ªé—®é¢˜
- æäº¤åä»£ç å¯ç¼–è¯‘è¿è¡Œ
- æäº¤æ¶ˆæ¯æè¿°æ¸…æ™°

âŒ å·®çš„æäº¤
- ä¸€ä¸ªæäº¤åŒ…å«å¤šä¸ªæ— å…³å˜æ›´
- æäº¤åä»£ç ç¼–è¯‘å¤±è´¥
- æ¶ˆæ¯æ¨¡ç³Šå¦‚ "fix bugs"
```

### 4.2 æäº¤é¢‘ç‡

```
æ¨è: å°è€Œé¢‘ç¹çš„æäº¤
- æ¯å®Œæˆä¸€ä¸ªå°åŠŸèƒ½å°±æäº¤
- æ–¹ä¾¿ä»£ç å®¡æŸ¥
- ä¾¿äºå›æ»š

é¿å…: å¤§è€Œç¨€ç–çš„æäº¤
- å‡ å¤©çš„å·¥ä½œåˆå¹¶æˆä¸€ä¸ªæäº¤
- éš¾ä»¥å®¡æŸ¥
- å›æ»šä»£ä»·å¤§
```

---

## 5. å±é™©æ“ä½œè­¦å‘Š

### 5.1 ç¦æ­¢çš„æ“ä½œ

| æ“ä½œ | é£é™© | æ›¿ä»£æ–¹æ¡ˆ |
|------|------|----------|
| `--amend` å·²æ¨é€ | è¦†ç›–å†å² | æ–°å»ºæäº¤ |
| `push --force` | è¦†ç›–è¿œç¨‹ | `--force-with-lease` |
| `reset --hard` | ä¸¢å¤±æ•°æ® | `stash` æˆ– `reset --soft` |
| `rebase` å…¬å…±åˆ†æ”¯ | ç ´åå†å² | merge |

### 5.2 éœ€è¦ç¡®è®¤çš„æ“ä½œ

```
âš ï¸ ä»¥ä¸‹æ“ä½œéœ€è¦ç”¨æˆ·æ˜ç¡®ç¡®è®¤:

1. --amend: ä¿®æ”¹æœ€è¿‘çš„æäº¤
2. --no-verify: è·³è¿‡ pre-commit hooks
3. æ¨é€åˆ°å—ä¿æŠ¤åˆ†æ”¯ (main/master)
4. æäº¤åŒ…å«æ•æ„Ÿæ–‡ä»¶
5. æäº¤å¤§æ–‡ä»¶ (>10MB)
```

---

## 6. æäº¤ç»“æœæ ¼å¼

### 6.1 æˆåŠŸç»“æœ

```json
{
  "status": "success",
  "commit_hash": "abc1234",
  "branch": "main",
  "message_title": "feat(auth): add JWT authentication",
  "files_committed": 3,
  "insertions": 150,
  "deletions": 20
}
```

### 6.2 å¤±è´¥ç»“æœ

```json
{
  "status": "failed",
  "error_type": "hook_failed",
  "error_message": "eslint: 3 errors found",
  "recoverable": true,
  "suggestions": [
    "Run 'npm run lint:fix' to auto-fix",
    "Use --no-verify to skip hooks"
  ]
}
```

---

## 7. æœ€ä½³å®è·µ

### 7.1 æäº¤å‰

- [ ] è¿è¡Œæµ‹è¯•ç¡®ä¿é€šè¿‡
- [ ] æ£€æŸ¥ diff ç¡®è®¤å˜æ›´æ­£ç¡®
- [ ] ç¡®è®¤æ²¡æœ‰æ•æ„Ÿä¿¡æ¯
- [ ] ç¡®è®¤æäº¤æ¶ˆæ¯ç¬¦åˆè§„èŒƒ

### 7.2 æäº¤å

- [ ] éªŒè¯æäº¤æˆåŠŸ
- [ ] æ£€æŸ¥ CI çŠ¶æ€
- [ ] å¿…è¦æ—¶æ¨é€åˆ°è¿œç¨‹

### 7.3 é—®é¢˜æ¢å¤

```bash
# æ’¤é”€æœ€è¿‘çš„æäº¤ï¼ˆä¿ç•™æ›´æ”¹ï¼‰
git reset --soft HEAD~1

# ä¿®æ”¹æœ€è¿‘çš„æäº¤æ¶ˆæ¯
git commit --amend -m "new message"

# æ’¤é”€æš‚å­˜
git reset HEAD <file>
```
