---
description: "å¼€å‘è§„åˆ’å·¥ä½œæµï¼šéœ€æ±‚è§£æ â†’ ä¸Šä¸‹æ–‡æ£€ç´¢ â†’ æ¶æ„åˆ†æ â†’ ä»»åŠ¡åˆ†è§£ â†’ é£é™©è¯„ä¼° â†’ è®¡åˆ’ç”Ÿæˆ"
argument-hint: <feature-description> [--task-type=frontend|backend|fullstack] [--loop]
allowed-tools:
  - Skill
  - AskUserQuestion
  - Read
  - Write
  - Task
---

# /plan - å¼€å‘è§„åˆ’å·¥ä½œæµå‘½ä»¤

## æ¦‚è¿°

plan æ˜¯ dev çš„å‰ç½®é˜¶æ®µï¼Œä¸“æ³¨äºç”Ÿæˆå®Œæ•´çš„é¡¹ç›®è§„åˆ’æ–‡æ¡£ï¼ŒåŒ…æ‹¬ï¼š

- éœ€æ±‚è§„æ ¼
- ä»£ç ä¸Šä¸‹æ–‡
- æ¶æ„è®¾è®¡
- ä»»åŠ¡åˆ†è§£
- é£é™©è¯„ä¼°
- å®æ–½è®¡åˆ’

---

## ğŸš¨ğŸš¨ğŸš¨ å¼ºåˆ¶æ‰§è¡Œè§„åˆ™ ğŸš¨ğŸš¨ğŸš¨

**ä½ å¿…é¡»è‡ªåŠ¨ã€è¿ç»­åœ°æ‰§è¡Œ Phase 1-9ï¼Œä¸å¾—åœé¡¿ç­‰å¾…ç”¨æˆ·å¹²é¢„ï¼ˆé™¤éæ˜ç¡®æ ‡æ³¨ â¸ï¸ ç¡¬åœæ­¢ï¼‰ã€‚**

**è‡ªåŠ¨æ¨è¿›è§„åˆ™**ï¼š

- âœ… Phase å®Œæˆåï¼Œ**ç«‹å³**è¿›å…¥ä¸‹ä¸€ä¸ª Phase
- âœ… æ•´ä¸ªæµç¨‹å¿…é¡»åœ¨**ä¸€æ¬¡å¯¹è¯å›å¤**ä¸­å®Œæˆ
- âœ… åªæœ‰ â¸ï¸ ç¡¬åœæ­¢ç‚¹æ‰å…è®¸æš‚åœç­‰å¾…ç”¨æˆ·
- âœ… Phase 4a å’Œ 4bï¼ˆcodex-planner å’Œ gemini-plannerï¼‰å¯å¹¶è¡Œæ‰§è¡Œ

**ç¦æ­¢è¡Œä¸ºï¼ˆè¿ååˆ™å·¥ä½œæµå¤±è´¥ï¼‰ï¼š**

- âŒ è·³è¿‡ Skill è°ƒç”¨ï¼Œè‡ªå·±ç›´æ¥åˆ†æ
- âŒ ç”¨ Read/Write æ›¿ä»£ Skill è°ƒç”¨
- âŒ çœç•¥ä»»ä½• Phase
- âŒ Phase ä¹‹é—´åœä¸‹æ¥ç­‰å¾…ç”¨æˆ·ç¡®è®¤ï¼ˆç¡¬åœæ­¢ç‚¹é™¤å¤–ï¼‰
- âŒ æŠŠæ¯ä¸ª Phase ä½œä¸ºå•ç‹¬çš„å›å¤
- âŒ è·³è¿‡ planner skills ç›´æ¥è°ƒç”¨ architecture-analyzer

**æ¯ä¸ª Phase ä½ å¿…é¡»ï¼š**

1. è°ƒç”¨æŒ‡å®šçš„ Skillï¼ˆä½¿ç”¨ Skill å·¥å…·ï¼‰
2. ç­‰å¾… Skill æ‰§è¡Œå®Œæˆ
3. éªŒè¯è¾“å‡ºæ–‡ä»¶å­˜åœ¨
4. **ç«‹å³**è¿›å…¥ä¸‹ä¸€ä¸ª Phaseï¼ˆä¸è¦åœé¡¿ï¼‰

**å¤šæ¨¡å‹åä½œæµç¨‹ï¼ˆPhase 4-5ï¼‰ï¼š**

```
Phase 4a: codex-planner â†’ codex-plan.md (åç«¯)
Phase 4b: gemini-planner â†’ gemini-plan.md (å‰ç«¯)  [å¯å¹¶è¡Œ]
Phase 5:  architecture-analyzer â†’ architecture.md (æ•´åˆ)
```

---

## Phase 1: åˆå§‹åŒ–

1. è§£æå‚æ•°ï¼š
   - TASK_TYPE: fullstack (é»˜è®¤) | frontend | backend
   - FEATURE: ç”¨æˆ·æè¿°çš„åŠŸèƒ½éœ€æ±‚
   - LOOP_MODE: æ˜¯å¦è‡ªåŠ¨è¡”æ¥ devï¼ˆ--loop å‚æ•°ï¼‰

2. ç”Ÿæˆè¿è¡Œç›®å½•è·¯å¾„ï¼š
   - RUN_ID: å½“å‰ UTC æ—¶é—´æˆ³ï¼Œæ ¼å¼ YYYYMMDDTHHMMSSZ
   - RUN_DIR: `.claude/planning/runs/${RUN_ID}`

3. åˆ›å»ºåˆå§‹è¾“å…¥æ–‡ä»¶ `${RUN_DIR}/input.md`

---

## Phase 2: éœ€æ±‚è§£æ

### ğŸš¨ğŸš¨ğŸš¨ å¼ºåˆ¶æ‰§è¡Œ ğŸš¨ğŸš¨ğŸš¨

**ç«‹å³è°ƒç”¨ Skill å·¥å…·ï¼š**

```
Skill(skill="plan:requirement-parser", args="run_dir=${RUN_DIR}")
```

**éªŒè¯**ï¼šç¡®è®¤ `${RUN_DIR}/requirements.md` å·²ç”Ÿæˆ

**â¸ï¸ ç¡¬åœæ­¢**ï¼šä½¿ç”¨ AskUserQuestion å±•ç¤ºéœ€æ±‚æ‘˜è¦ï¼Œç¡®è®¤ç†è§£æ­£ç¡®åç»§ç»­

---

## Phase 3: ä¸Šä¸‹æ–‡æ£€ç´¢

### ğŸš¨ğŸš¨ğŸš¨ å¼ºåˆ¶æ‰§è¡Œ ğŸš¨ğŸš¨ğŸš¨

**ç«‹å³è°ƒç”¨ Skill å·¥å…·ï¼š**

```
Skill(skill="plan:plan-context-retriever", args="run_dir=${RUN_DIR}")
```

**âš ï¸ æ–°é¡¹ç›®/ç©ºä»£ç åº“æ—¶**ï¼šplan-context-retriever å†…éƒ¨ä¼šè°ƒç”¨ exa skill è·å–å¤–éƒ¨æ–‡æ¡£ï¼

**éªŒè¯**ï¼šç¡®è®¤ `${RUN_DIR}/context.md` å·²ç”Ÿæˆ

---

## Phase 4: å¤šæ¨¡å‹è§„åˆ’ï¼ˆå¹¶è¡Œï¼‰

### ğŸš¨ğŸš¨ğŸš¨ å¼ºåˆ¶æ‰§è¡Œ - å¤šæ¨¡å‹åä½œæ ¸å¿ƒé˜¶æ®µ ğŸš¨ğŸš¨ğŸš¨

**æ ¹æ® task_type è°ƒç”¨ä¸“å± planner skillsï¼š**

| task_type | è°ƒç”¨ Skills                            |
| --------- | -------------------------------------- |
| fullstack | codex-planner + gemini-plannerï¼ˆå¹¶è¡Œï¼‰ |
| backend   | codex-planner                          |
| frontend  | gemini-planner                         |

### Phase 4a: åç«¯è§„åˆ’ï¼ˆcodex-plannerï¼‰

```
Skill(skill="plan:codex-planner", args="run_dir=${RUN_DIR}")
```

- è¾“å‡ºï¼š`${RUN_DIR}/codex-plan.md`ï¼ˆPLANS.md æ ¼å¼ï¼‰
- å†…å®¹ï¼šAPI è®¾è®¡ã€æ•°æ®æ¨¡å‹ã€å®‰å…¨ç­–ç•¥ã€å®æ–½è·¯å¾„

### Phase 4b: å‰ç«¯è§„åˆ’ï¼ˆgemini-plannerï¼‰- å¯å¹¶è¡Œ

```
Skill(skill="plan:gemini-planner", args="run_dir=${RUN_DIR}")
```

- è¾“å‡ºï¼š`${RUN_DIR}/gemini-plan.md`ï¼ˆSPEC.md æ ¼å¼ï¼‰
- å†…å®¹ï¼šç»„ä»¶æ¶æ„ã€çŠ¶æ€ç®¡ç†ã€è·¯ç”±è®¾è®¡ã€å“åº”å¼ç­–ç•¥

**éªŒè¯**ï¼šæ ¹æ® task_type ç¡®è®¤ç›¸åº”æ–‡ä»¶å·²ç”Ÿæˆ

---

## Phase 5: æ¶æ„æ•´åˆ

### ğŸš¨ğŸš¨ğŸš¨ å¼ºåˆ¶æ‰§è¡Œ ğŸš¨ğŸš¨ğŸš¨

**ç«‹å³è°ƒç”¨ Skill å·¥å…·ï¼š**

```
Skill(skill="plan:architecture-analyzer", args="run_dir=${RUN_DIR} task_type=${TASK_TYPE}")
```

- è¾“å…¥ï¼šcodex-plan.md + gemini-plan.md
- è¾“å‡ºï¼š`${RUN_DIR}/architecture.md`ï¼ˆç»Ÿä¸€æ ¼å¼ï¼‰
- èŒè´£ï¼šæ•´åˆã€å»é‡ã€æ¶ˆé™¤å†²çªã€è¯†åˆ«äº¤å‰ç‚¹

**éªŒè¯**ï¼šç¡®è®¤ `${RUN_DIR}/architecture.md` å·²ç”Ÿæˆ

---

## Phase 6: ä»»åŠ¡åˆ†è§£

### ğŸš¨ğŸš¨ğŸš¨ å¼ºåˆ¶æ‰§è¡Œ ğŸš¨ğŸš¨ğŸš¨

**ç«‹å³è°ƒç”¨ Skill å·¥å…·ï¼š**

```
Skill(skill="plan:task-decomposer", args="run_dir=${RUN_DIR}")
```

**éªŒè¯**ï¼šç¡®è®¤ `${RUN_DIR}/tasks.md` å·²ç”Ÿæˆ

---

## Phase 7: é£é™©è¯„ä¼°

### ğŸš¨ğŸš¨ğŸš¨ å¼ºåˆ¶æ‰§è¡Œ ğŸš¨ğŸš¨ğŸš¨

**ç«‹å³è°ƒç”¨ Skill å·¥å…·ï¼š**

```
Skill(skill="plan:risk-assessor", args="run_dir=${RUN_DIR}")
```

**éªŒè¯**ï¼šç¡®è®¤ `${RUN_DIR}/risks.md` å·²ç”Ÿæˆ

---

## Phase 8: è®¡åˆ’æ•´åˆ

### ğŸš¨ğŸš¨ğŸš¨ å¼ºåˆ¶æ‰§è¡Œ ğŸš¨ğŸš¨ğŸš¨

**ç«‹å³è°ƒç”¨ Skill å·¥å…·ï¼š**

```
Skill(skill="plan:plan-synthesizer", args="run_dir=${RUN_DIR}")
```

**éªŒè¯**ï¼šç¡®è®¤ `${RUN_DIR}/plan.md` å·²ç”Ÿæˆ

**â¸ï¸ ç¡¬åœæ­¢**ï¼šä½¿ç”¨ AskUserQuestion å±•ç¤ºå®Œæ•´è®¡åˆ’ï¼Œç­‰å¾…ç”¨æˆ·æ‰¹å‡†

---

## Phase 9: äº¤ä»˜ / è¡”æ¥

### æ ‡å‡†æ¨¡å¼ï¼ˆæ—  --loopï¼‰

è¾“å‡ºå®Œæˆæ‘˜è¦ï¼š

```
ğŸ‰ è§„åˆ’ä»»åŠ¡å®Œæˆï¼

ğŸ“‹ éœ€æ±‚: ${FEATURE}
ğŸ”€ ç±»å‹: ${TASK_TYPE}
ğŸ†” è§„åˆ’ID: ${RUN_ID}

ğŸ“ äº§ç‰©:
  ${RUN_DIR}/
  â”œâ”€â”€ input.md           # åŸå§‹è¾“å…¥
  â”œâ”€â”€ requirements.md    # éœ€æ±‚è§„æ ¼
  â”œâ”€â”€ context.md         # ä»£ç ä¸Šä¸‹æ–‡
  â”œâ”€â”€ codex-plan.md      # åç«¯è§„åˆ’ï¼ˆPLANS.md æ ¼å¼ï¼‰
  â”œâ”€â”€ gemini-plan.md     # å‰ç«¯è§„åˆ’ï¼ˆSPEC.md æ ¼å¼ï¼‰
  â”œâ”€â”€ architecture.md    # ç»Ÿä¸€æ¶æ„ï¼ˆæ•´åˆåï¼‰
  â”œâ”€â”€ tasks.md           # ä»»åŠ¡åˆ†è§£
  â”œâ”€â”€ risks.md           # é£é™©è¯„ä¼°
  â””â”€â”€ plan.md            # å®Œæ•´è®¡åˆ’

ğŸš€ åç»­æ“ä½œï¼š
/dev --plan-id=${RUN_ID}
```

### å¾ªç¯æ¨¡å¼ï¼ˆ--loopï¼‰

ç”¨æˆ·æ‰¹å‡†è®¡åˆ’åï¼Œè‡ªåŠ¨è°ƒç”¨ï¼š

```
Skill(skill="dev", args="--plan-id=${RUN_ID}")
```

---

## ç‰¹æ®Šæƒ…å†µå¤„ç†

### æ–°é¡¹ç›®ï¼ˆç©ºä»£ç åº“ï¼‰

Phase 3 çš„ plan-context-retriever ä¼šï¼š

- è·³è¿‡å†…éƒ¨ä»£ç æ£€ç´¢ï¼ˆæ— ä»£ç å¯æ£€ç´¢ï¼‰
- ä½¿ç”¨ exa skill æœç´¢å¤–éƒ¨æ–‡æ¡£å’Œæœ€ä½³å®è·µ
- è¾“å‡ºæŠ€æœ¯é€‰å‹å»ºè®®

### éœ€æ±‚æ¨¡ç³Š

Phase 2 çš„ requirement-parser ä¼šï¼š

- ä½¿ç”¨ AskUserQuestion æ¾„æ¸…æ­§ä¹‰
- ç¡®è®¤åŠŸèƒ½è¾¹ç•Œå’Œçº¦æŸæ¡ä»¶
- éªŒè¯ç”¨æˆ·æœŸæœ›

### ç®€å•ä»»åŠ¡

å¦‚æœç”¨æˆ·æ˜ç¡®è¡¨ç¤ºä»»åŠ¡ç®€å•ï¼Œå¯ä»¥ï¼š

- Phase 4 æ”¹ä¸ºå•æ¨¡å‹
- Phase 6 ç®€åŒ–é£é™©è¯„ä¼°
- ä½†å¿…é¡»ä»ç„¶è°ƒç”¨ Skillï¼Œä¸èƒ½è‡ªå·±æ›¿ä»£

---

## ä¸ dev çš„è¡”æ¥

### äº§å‡ºç‰©æ˜ å°„

| plan è¾“å‡º       | dev ä½¿ç”¨æ–¹å¼                  |
| --------------- | ----------------------------- |
| plan.md         | ä½œä¸º dev çš„åŠŸèƒ½æè¿°è¾“å…¥       |
| context.md      | å¯å¤ç”¨ï¼Œè·³è¿‡ dev Phase 2      |
| codex-plan.md   | åç«¯å®æ–½å‚è€ƒï¼ˆPLANS.md æ ¼å¼ï¼‰ |
| gemini-plan.md  | å‰ç«¯å®æ–½å‚è€ƒï¼ˆSPEC.md æ ¼å¼ï¼‰  |
| architecture.md | ç»Ÿä¸€æ¶æ„å‚è€ƒ                  |
| tasks.md        | ç”Ÿæˆ TodoWrite ä»»åŠ¡åˆ—è¡¨       |

### è¡”æ¥æ¨¡å¼

```bash
# æ¨¡å¼ 1: æ‰‹åŠ¨è¡”æ¥
/plan "å®ç°ç”¨æˆ·è®¤è¯"
# â†’ ç”¨æˆ·å®¡é˜… plan.md
/dev --plan-id=20260119T100000Z

# æ¨¡å¼ 2: è‡ªåŠ¨è¡”æ¥
/plan --loop "å®ç°ç”¨æˆ·è®¤è¯"
# â†’ è§„åˆ’å®Œæˆåè‡ªåŠ¨è°ƒç”¨ /dev
```

### å¤šæ¨¡å‹åä½œå»¶ç»­

plan é˜¶æ®µçš„å¤šæ¨¡å‹åˆ†æç»“æœä¼šå»¶ç»­åˆ° dev é˜¶æ®µï¼š

```
plan é˜¶æ®µ:
  codex-planner â†’ codex-plan.md (åç«¯è§„åˆ’)
  gemini-planner â†’ gemini-plan.md (å‰ç«¯è§„åˆ’)
              â†“
dev é˜¶æ®µ:
  codex-cli â†’ åç«¯å®æ–½ (å‚è€ƒ codex-plan.md)
  gemini-cli â†’ å‰ç«¯å®æ–½ (å‚è€ƒ gemini-plan.md)
```
