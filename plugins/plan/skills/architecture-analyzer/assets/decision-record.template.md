# ADR-{{number}}: {{title}}

## 状态

{{status}}

<!-- 状态选项: 提议中 | 已接受 | 已废弃 | 已取代 -->

## 上下文

{{context}}

<!-- 描述推动这个决策的背景和问题 -->

## 决策驱动因素

{{#each drivers}}

- {{this}}
  {{/each}}

## 考虑的选项

{{#each options}}

### 选项 {{@index}}: {{name}}

**描述**: {{description}}

**优点**:
{{#each pros}}

- ✅ {{this}}
  {{/each}}

**缺点**:
{{#each cons}}

- ❌ {{this}}
  {{/each}}

{{/each}}

## 决策

选择 **{{chosen_option}}**

**理由**:

{{rationale}}

## 后果

### 积极后果

{{#each positive_consequences}}

- ✅ {{this}}
  {{/each}}

### 消极后果

{{#each negative_consequences}}

- ⚠️ {{this}}
  {{/each}}

### 风险

{{#each risks}}

- 🔴 {{this}}
  {{/each}}

## 相关决策

{{#if related_adrs}}
{{#each related_adrs}}

- [ADR-{{number}}]({{link}}): {{title}}
  {{/each}}
  {{else}}
  无
  {{/if}}

## 注释

{{#if notes}}
{{notes}}
{{/if}}

---

## 元数据

| 属性     | 值                |
| -------- | ----------------- |
| 决策日期 | {{decision_date}} |
| 决策者   | {{deciders}}      |
| 审核人   | {{reviewers}}     |
| 最后更新 | {{last_updated}}  |

---

# ADR 示例

## ADR-001: 使用 JWT 进行用户认证

## 状态

已接受

## 上下文

系统需要一个安全、可扩展的用户认证方案。需要支持多端（Web、Mobile）访问，并且能够在微服务架构中有效工作。

## 决策驱动因素

- 需要无状态认证以支持水平扩展
- 多端（Web/Mobile/API）统一认证
- 微服务间认证传递
- 安全性要求（Token 过期、刷新机制）

## 考虑的选项

### 选项 1: Session-based 认证

**描述**: 使用服务端 Session 存储用户状态，客户端持有 Session ID。

**优点**:

- ✅ 服务端可以主动撤销会话
- ✅ 实现简单，成熟方案
- ✅ Session 数据安全性高（存储在服务端）

**缺点**:

- ❌ 需要 Session 存储（Redis）增加基础设施
- ❌ 水平扩展需要 Sticky Session 或共享存储
- ❌ 跨服务认证复杂

### 选项 2: JWT Token 认证

**描述**: 使用 JWT Token 进行无状态认证，包含用户信息和签名。

**优点**:

- ✅ 无状态，易于水平扩展
- ✅ 跨服务认证简单，只需验证签名
- ✅ 减少数据库查询
- ✅ 移动端友好

**缺点**:

- ❌ Token 无法主动撤销（除非使用黑名单）
- ❌ Token 较大，增加网络传输
- ❌ 密钥管理需要额外关注

### 选项 3: OAuth 2.0 + OpenID Connect

**描述**: 使用标准 OAuth 2.0 协议，委托给专门的认证服务。

**优点**:

- ✅ 标准协议，支持第三方登录
- ✅ 职责分离，认证服务独立
- ✅ 支持细粒度权限控制

**缺点**:

- ❌ 实现复杂度高
- ❌ 对于简单应用过度设计
- ❌ 需要额外的认证服务

## 决策

选择 **JWT Token 认证**

**理由**:

1. 系统需要支持多端访问，JWT 的无状态特性非常适合
2. 当前阶段不需要第三方登录，OAuth 2.0 过于复杂
3. 微服务架构下，JWT 的服务间认证传递简单
4. Token 撤销问题可以通过 Refresh Token + 短期 Access Token 缓解

## 后果

### 积极后果

- ✅ 服务可以独立验证用户身份，无需查询数据库
- ✅ 水平扩展简单，无需共享会话状态
- ✅ 移动端和 Web 端使用统一的认证方式

### 消极后果

- ⚠️ 需要实现 Refresh Token 机制来平衡安全性和用户体验
- ⚠️ 需要注意 Token 大小对性能的影响

### 风险

- 🔴 JWT 密钥泄露会导致安全问题，需要实施密钥轮换
- 🔴 Token 被盗用时无法立即撤销，需要考虑黑名单机制

## 相关决策

- ADR-002: Refresh Token 存储策略
- ADR-003: 密钥管理方案

## 注释

后续可以考虑添加 OAuth 2.0 支持以接入第三方登录。

---

## 元数据

| 属性     | 值                 |
| -------- | ------------------ |
| 决策日期 | 2024-01-19         |
| 决策者   | 架构师、技术负责人 |
| 审核人   | 安全团队           |
| 最后更新 | 2024-01-19         |
