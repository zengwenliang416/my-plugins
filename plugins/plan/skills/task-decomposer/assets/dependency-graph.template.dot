// 任务依赖图模板 - Graphviz DOT 格式
// 使用: dot -Tpng dependency.dot -o dependency.png

digraph TaskDependencies {
    // 图属性
    rankdir=LR;                    // 从左到右布局
    splines=ortho;                 // 正交连线
    nodesep=0.8;                   // 节点间距
    ranksep=1.2;                   // 层级间距

    // 全局节点样式
    node [
        shape=box,
        style="rounded,filled",
        fontname="Helvetica",
        fontsize=11,
        margin="0.3,0.2"
    ];

    // 全局边样式
    edge [
        color="#666666",
        penwidth=1.5,
        arrowsize=0.8
    ];

    // ============================================
    // 节点颜色定义（按任务类型）
    // ============================================

    // 后端任务 - 蓝色系
    node [fillcolor="#DBEAFE", color="#3B82F6"] {
        {{#each backend_tasks}}
        "{{id}}" [label="{{id}}\n{{name}}"];
        {{/each}}
    }

    // 前端任务 - 绿色系
    node [fillcolor="#D1FAE5", color="#10B981"] {
        {{#each frontend_tasks}}
        "{{id}}" [label="{{id}}\n{{name}}"];
        {{/each}}
    }

    // 基础设施任务 - 紫色系
    node [fillcolor="#E0E7FF", color="#6366F1"] {
        {{#each infra_tasks}}
        "{{id}}" [label="{{id}}\n{{name}}"];
        {{/each}}
    }

    // 测试任务 - 黄色系
    node [fillcolor="#FEF3C7", color="#F59E0B"] {
        {{#each test_tasks}}
        "{{id}}" [label="{{id}}\n{{name}}"];
        {{/each}}
    }

    // 关键路径任务 - 红色边框
    {{#each critical_tasks}}
    "{{id}}" [color="#EF4444", penwidth=3];
    {{/each}}

    // ============================================
    // 依赖关系（边）
    // ============================================

    // 普通依赖
    {{#each dependencies}}
    "{{from}}" -> "{{to}}";
    {{/each}}

    // 关键路径依赖 - 红色粗线
    {{#each critical_dependencies}}
    "{{from}}" -> "{{to}}" [color="#EF4444", penwidth=2.5];
    {{/each}}

    // ============================================
    // 阶段分组（子图）
    // ============================================

    {{#each phases}}
    subgraph cluster_{{id}} {
        label="阶段 {{order}}: {{name}}";
        style=dashed;
        color="#9CA3AF";
        fontsize=12;
        fontname="Helvetica-Bold";

        {{#each tasks}}
        "{{id}}";
        {{/each}}
    }
    {{/each}}

    // ============================================
    // 里程碑节点
    // ============================================

    node [
        shape=diamond,
        fillcolor="#FEE2E2",
        color="#DC2626",
        width=1.5,
        height=0.8
    ] {
        {{#each milestones}}
        "{{id}}" [label="{{name}}"];
        {{/each}}
    }

    // 里程碑依赖
    {{#each milestone_dependencies}}
    "{{from}}" -> "{{to}}" [style=dashed, color="#DC2626"];
    {{/each}}

    // ============================================
    // 图例
    // ============================================

    subgraph cluster_legend {
        label="图例";
        style=filled;
        fillcolor="#F9FAFB";
        fontsize=10;

        node [width=1.2, height=0.4, fontsize=9];

        legend_backend [label="后端", fillcolor="#DBEAFE", color="#3B82F6"];
        legend_frontend [label="前端", fillcolor="#D1FAE5", color="#10B981"];
        legend_infra [label="基础设施", fillcolor="#E0E7FF", color="#6366F1"];
        legend_test [label="测试", fillcolor="#FEF3C7", color="#F59E0B"];
        legend_critical [label="关键路径", fillcolor="#FEE2E2", color="#EF4444", penwidth=3];

        legend_backend -> legend_frontend [style=invis];
        legend_frontend -> legend_infra [style=invis];
        legend_infra -> legend_test [style=invis];
        legend_test -> legend_critical [style=invis];
    }
}

// ============================================
// 示例实例
// ============================================

/*
digraph Example {
    rankdir=LR;
    node [shape=box, style="rounded,filled"];

    // 阶段 1: 基础设施
    subgraph cluster_p1 {
        label="阶段 1: 基础设施";
        style=dashed;

        "T-001" [label="T-001\n数据库迁移", fillcolor="#E0E7FF", color="#6366F1"];
        "T-002" [label="T-002\n配置管理", fillcolor="#E0E7FF", color="#6366F1"];
    }

    // 阶段 2: 核心功能
    subgraph cluster_p2 {
        label="阶段 2: 核心功能";
        style=dashed;

        "T-003" [label="T-003\n认证 API", fillcolor="#DBEAFE", color="#3B82F6"];
        "T-004" [label="T-004\n登录表单", fillcolor="#D1FAE5", color="#10B981"];
    }

    // 阶段 3: 集成
    subgraph cluster_p3 {
        label="阶段 3: 集成";
        style=dashed;

        "T-005" [label="T-005\nE2E 测试", fillcolor="#FEF3C7", color="#F59E0B"];
    }

    // 关键路径
    "T-001" [color="#EF4444", penwidth=3];
    "T-003" [color="#EF4444", penwidth=3];
    "T-005" [color="#EF4444", penwidth=3];

    // 依赖
    "T-001" -> "T-003";
    "T-002" -> "T-003";
    "T-003" -> "T-005" [color="#EF4444", penwidth=2.5];
    "T-004" -> "T-005";

    // 关键路径依赖
    "T-001" -> "T-003" [color="#EF4444", penwidth=2.5];
}
*/
