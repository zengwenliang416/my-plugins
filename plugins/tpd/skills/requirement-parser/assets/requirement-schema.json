{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Requirement Schema",
  "description": "需求解析结构化输出格式",
  "type": "object",
  "required": ["meta", "functional_requirements", "task_type"],
  "properties": {
    "meta": {
      "type": "object",
      "description": "元信息",
      "required": ["parsed_at", "task_type", "weight"],
      "properties": {
        "parsed_at": {
          "type": "string",
          "format": "date-time",
          "description": "解析时间"
        },
        "task_type": {
          "type": "string",
          "enum": ["frontend", "backend", "fullstack"],
          "description": "任务类型"
        },
        "weight": {
          "type": "object",
          "properties": {
            "frontend": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            },
            "backend": {
              "type": "number",
              "minimum": 0,
              "maximum": 100
            }
          }
        }
      }
    },
    "summary": {
      "type": "string",
      "description": "需求概述（一句话）"
    },
    "functional_requirements": {
      "type": "array",
      "description": "功能需求列表",
      "items": {
        "type": "object",
        "required": ["id", "description", "priority"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^FR-[0-9]{3}$",
            "description": "需求ID，格式 FR-XXX"
          },
          "description": {
            "type": "string",
            "description": "需求描述"
          },
          "priority": {
            "type": "string",
            "enum": ["P1", "P2", "P3"],
            "description": "优先级"
          },
          "user_story": {
            "type": "object",
            "properties": {
              "as_a": {
                "type": "string",
                "description": "角色"
              },
              "i_want": {
                "type": "string",
                "description": "功能"
              },
              "so_that": {
                "type": "string",
                "description": "价值"
              }
            }
          },
          "acceptance_criteria": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "验收标准"
          },
          "business_rules": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "业务规则"
          }
        }
      }
    },
    "non_functional_requirements": {
      "type": "array",
      "description": "非功能需求列表",
      "items": {
        "type": "object",
        "required": ["id", "category", "constraint"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^NFR-[0-9]{3}$",
            "description": "需求ID，格式 NFR-XXX"
          },
          "category": {
            "type": "string",
            "enum": [
              "performance",
              "security",
              "availability",
              "scalability",
              "maintainability",
              "accessibility",
              "compliance"
            ],
            "description": "NFR 类别"
          },
          "constraint": {
            "type": "string",
            "description": "约束描述"
          },
          "metric": {
            "type": "string",
            "description": "度量指标"
          },
          "priority": {
            "type": "string",
            "enum": ["P1", "P2", "P3"]
          }
        }
      }
    },
    "ui_ux_requirements": {
      "type": "array",
      "description": "UI/UX 需求列表",
      "items": {
        "type": "object",
        "required": ["id", "component"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^UX-[0-9]{3}$"
          },
          "component": {
            "type": "string",
            "description": "组件/页面名称"
          },
          "interaction": {
            "type": "string",
            "description": "交互描述"
          },
          "visual_spec": {
            "type": "string",
            "description": "视觉规格"
          },
          "responsive": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "响应式要求"
          },
          "accessibility": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "无障碍要求"
          }
        }
      }
    },
    "constraints": {
      "type": "object",
      "description": "约束条件",
      "properties": {
        "technical": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "技术约束"
        },
        "business": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "业务约束"
        },
        "compatibility": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "兼容约束"
        },
        "compliance": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "合规约束"
        }
      }
    },
    "assumptions": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "假设"
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "依赖"
    },
    "open_questions": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "待澄清事项"
    },
    "evidence": {
      "type": "array",
      "description": "证据（代码片段等）",
      "items": {
        "type": "object",
        "properties": {
          "file": {
            "type": "string",
            "description": "文件路径"
          },
          "line": {
            "type": "integer",
            "description": "行号"
          },
          "reason": {
            "type": "string",
            "description": "相关原因"
          }
        }
      }
    },
    "task_type": {
      "type": "string",
      "enum": ["frontend", "backend", "fullstack"],
      "description": "任务类型"
    }
  }
}
