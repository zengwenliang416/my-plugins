{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "WBS Rules Configuration",
  "description": "WBS 工作分解结构规则配置",
  "type": "object",
  "properties": {
    "version": {
      "type": "string",
      "default": "1.0.0"
    },
    "levels": {
      "type": "object",
      "description": "层级定义",
      "properties": {
        "max_depth": {
          "type": "integer",
          "default": 4,
          "description": "最大层级深度"
        },
        "definitions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "level": { "type": "integer" },
              "name": { "type": "string" },
              "name_zh": { "type": "string" },
              "description": { "type": "string" }
            }
          },
          "default": [
            {
              "level": 0,
              "name": "Project",
              "name_zh": "项目",
              "description": "项目整体"
            },
            {
              "level": 1,
              "name": "Phase",
              "name_zh": "阶段",
              "description": "主要阶段或模块"
            },
            {
              "level": 2,
              "name": "Work Package",
              "name_zh": "工作包",
              "description": "可分配的工作单元"
            },
            {
              "level": 3,
              "name": "Task",
              "name_zh": "任务",
              "description": "具体可执行任务"
            },
            {
              "level": 4,
              "name": "Subtask",
              "name_zh": "子任务",
              "description": "任务的细分"
            }
          ]
        }
      }
    },
    "task_constraints": {
      "type": "object",
      "description": "任务约束",
      "properties": {
        "min_hours": {
          "type": "number",
          "default": 0.5,
          "description": "最小工时（小时）"
        },
        "max_hours": {
          "type": "number",
          "default": 8,
          "description": "最大工时（小时）"
        },
        "ideal_hours": {
          "type": "object",
          "properties": {
            "min": { "type": "number", "default": 1 },
            "max": { "type": "number", "default": 4 }
          },
          "description": "理想工时范围"
        }
      }
    },
    "task_types": {
      "type": "array",
      "description": "任务类型",
      "items": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "color": { "type": "string" },
          "base_hours": { "type": "number" }
        }
      },
      "default": [
        {
          "id": "backend",
          "name": "后端",
          "color": "#3B82F6",
          "base_hours": 3
        },
        {
          "id": "frontend",
          "name": "前端",
          "color": "#10B981",
          "base_hours": 2
        },
        {
          "id": "infra",
          "name": "基础设施",
          "color": "#6366F1",
          "base_hours": 2
        },
        { "id": "test", "name": "测试", "color": "#F59E0B", "base_hours": 2 },
        { "id": "doc", "name": "文档", "color": "#8B5CF6", "base_hours": 1 },
        { "id": "design", "name": "设计", "color": "#EC4899", "base_hours": 2 }
      ]
    },
    "complexity_scale": {
      "type": "object",
      "description": "复杂度评分",
      "properties": {
        "min": { "type": "integer", "default": 1 },
        "max": { "type": "integer", "default": 5 },
        "factors": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "weight": { "type": "number" },
              "levels": {
                "type": "object",
                "additionalProperties": { "type": "string" }
              }
            }
          },
          "default": [
            {
              "name": "technical_difficulty",
              "weight": 0.3,
              "levels": {
                "1": "常规实现",
                "2": "略有难度",
                "3": "需要研究",
                "4": "显著复杂",
                "5": "前沿/未知"
              }
            },
            {
              "name": "code_volume",
              "weight": 0.2,
              "levels": {
                "1": "< 50 行",
                "2": "50-100 行",
                "3": "100-300 行",
                "4": "300-500 行",
                "5": "> 500 行"
              }
            },
            {
              "name": "dependency_complexity",
              "weight": 0.2,
              "levels": {
                "1": "无外部依赖",
                "2": "1-2 个依赖",
                "3": "3-5 个依赖",
                "4": "多外部依赖",
                "5": "复杂依赖链"
              }
            },
            {
              "name": "test_difficulty",
              "weight": 0.15,
              "levels": {
                "1": "简单单元测试",
                "2": "多单元测试",
                "3": "需要 Mock",
                "4": "集成测试",
                "5": "E2E 测试"
              }
            },
            {
              "name": "risk_level",
              "weight": 0.15,
              "levels": {
                "1": "低风险",
                "2": "略有风险",
                "3": "中风险",
                "4": "较高风险",
                "5": "高风险"
              }
            }
          ]
        },
        "multipliers": {
          "type": "object",
          "description": "复杂度工时系数",
          "additionalProperties": { "type": "number" },
          "default": {
            "1": 1.0,
            "2": 1.3,
            "3": 1.6,
            "4": 2.0,
            "5": 2.5
          }
        }
      }
    },
    "uncertainty_factors": {
      "type": "object",
      "description": "不确定性系数",
      "additionalProperties": { "type": "number" },
      "default": {
        "familiar": 1.0,
        "partially_familiar": 1.3,
        "unfamiliar": 1.5,
        "new_technology": 2.0
      }
    },
    "priority_levels": {
      "type": "array",
      "description": "优先级定义 (MoSCoW)",
      "items": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" },
          "suggested_ratio": { "type": "number" }
        }
      },
      "default": [
        {
          "id": "must",
          "name": "Must Have",
          "description": "必须完成",
          "suggested_ratio": 0.6
        },
        {
          "id": "should",
          "name": "Should Have",
          "description": "应该完成",
          "suggested_ratio": 0.2
        },
        {
          "id": "could",
          "name": "Could Have",
          "description": "可以完成",
          "suggested_ratio": 0.15
        },
        {
          "id": "wont",
          "name": "Won't Have",
          "description": "本次不做",
          "suggested_ratio": 0.05
        }
      ]
    },
    "naming_conventions": {
      "type": "object",
      "description": "命名规范",
      "properties": {
        "verbs": {
          "type": "object",
          "description": "推荐动词",
          "properties": {
            "create": { "type": "array", "items": { "type": "string" } },
            "modify": { "type": "array", "items": { "type": "string" } },
            "remove": { "type": "array", "items": { "type": "string" } },
            "test": { "type": "array", "items": { "type": "string" } },
            "document": { "type": "array", "items": { "type": "string" } },
            "configure": { "type": "array", "items": { "type": "string" } },
            "integrate": { "type": "array", "items": { "type": "string" } },
            "optimize": { "type": "array", "items": { "type": "string" } }
          },
          "default": {
            "create": ["Create", "Implement", "Build", "Design", "Add"],
            "modify": ["Update", "Modify", "Refactor", "Enhance", "Improve"],
            "remove": ["Remove", "Delete", "Deprecate", "Clean"],
            "test": ["Test", "Validate", "Verify", "Check"],
            "document": ["Document", "Write", "Describe", "Explain"],
            "configure": ["Configure", "Setup", "Initialize", "Deploy"],
            "integrate": ["Integrate", "Connect", "Sync", "Link"],
            "optimize": ["Optimize", "Improve", "Tune", "Enhance"]
          }
        },
        "anti_patterns": {
          "type": "array",
          "description": "应避免的命名",
          "items": { "type": "string" },
          "default": [
            "Do stuff",
            "Fix bugs",
            "Misc improvements",
            "TBD",
            "TODO",
            "Various updates"
          ]
        }
      }
    },
    "fullstack_strategy": {
      "type": "object",
      "description": "全栈分解策略",
      "properties": {
        "contract_first": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean", "default": true },
            "phases": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "order": { "type": "integer" },
                  "name": { "type": "string" },
                  "description": { "type": "string" },
                  "parallel_allowed": { "type": "boolean" }
                }
              },
              "default": [
                {
                  "order": 1,
                  "name": "contract",
                  "description": "定义 API 接口契约",
                  "parallel_allowed": true
                },
                {
                  "order": 2,
                  "name": "mock",
                  "description": "创建 Mock 数据",
                  "parallel_allowed": true
                },
                {
                  "order": 3,
                  "name": "parallel_dev",
                  "description": "并行开发",
                  "parallel_allowed": true
                },
                {
                  "order": 4,
                  "name": "integration",
                  "description": "集成联调",
                  "parallel_allowed": false
                },
                {
                  "order": 5,
                  "name": "e2e_test",
                  "description": "E2E 测试",
                  "parallel_allowed": false
                }
              ]
            }
          }
        },
        "dependency_mapping": {
          "type": "array",
          "description": "前后端依赖映射",
          "items": {
            "type": "object",
            "properties": {
              "backend_task": { "type": "string" },
              "frontend_task": { "type": "string" },
              "dependency_type": {
                "type": "string",
                "enum": ["parallel", "frontend_waits", "backend_waits"]
              }
            }
          },
          "default": [
            {
              "backend_task": "design_api",
              "frontend_task": "define_types",
              "dependency_type": "parallel"
            },
            {
              "backend_task": "implement_api",
              "frontend_task": "implement_api_layer",
              "dependency_type": "frontend_waits"
            },
            {
              "backend_task": "write_api_docs",
              "frontend_task": "create_mock",
              "dependency_type": "parallel"
            },
            {
              "backend_task": "business_logic",
              "frontend_task": "ui_components",
              "dependency_type": "parallel"
            },
            {
              "backend_task": "integration_test",
              "frontend_task": "component_test",
              "dependency_type": "parallel"
            }
          ]
        }
      }
    },
    "validation_rules": {
      "type": "object",
      "description": "验证规则",
      "properties": {
        "hundred_percent_rule": {
          "type": "boolean",
          "default": true,
          "description": "强制 100% 规则检查"
        },
        "no_circular_dependencies": {
          "type": "boolean",
          "default": true,
          "description": "禁止循环依赖"
        },
        "require_acceptance_criteria": {
          "type": "boolean",
          "default": true,
          "description": "必须有验收标准"
        },
        "require_deliverable": {
          "type": "boolean",
          "default": true,
          "description": "必须有交付物"
        }
      }
    }
  }
}
