{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Evidence Capture Template",
  "description": "证据采集模板",
  "type": "object",
  "required": ["id", "type", "source", "content", "metadata"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^EVD-[0-9]{3}$",
      "description": "证据唯一标识符",
      "examples": ["EVD-001", "EVD-002"]
    },
    "type": {
      "type": "string",
      "enum": ["code", "config", "doc", "external", "test"],
      "description": "证据类型"
    },
    "category": {
      "type": "string",
      "enum": [
        "implementation",
        "interface",
        "dependency",
        "entry_point",
        "configuration",
        "documentation",
        "test_case",
        "external_reference"
      ],
      "description": "证据分类"
    },
    "source": {
      "type": "object",
      "description": "证据来源",
      "required": ["file"],
      "properties": {
        "file": {
          "type": "string",
          "description": "文件路径"
        },
        "line_start": {
          "type": "integer",
          "minimum": 1,
          "description": "起始行号"
        },
        "line_end": {
          "type": "integer",
          "minimum": 1,
          "description": "结束行号"
        },
        "repository": {
          "type": "string",
          "description": "仓库名称"
        },
        "commit": {
          "type": "string",
          "pattern": "^[a-f0-9]{7,40}$",
          "description": "Git commit hash"
        },
        "branch": {
          "type": "string",
          "description": "Git 分支"
        },
        "url": {
          "type": "string",
          "format": "uri",
          "description": "外部来源 URL"
        }
      }
    },
    "content": {
      "type": "object",
      "description": "证据内容",
      "properties": {
        "snippet": {
          "type": "string",
          "description": "代码/文本片段"
        },
        "language": {
          "type": "string",
          "description": "编程语言",
          "examples": [
            "typescript",
            "javascript",
            "python",
            "go",
            "rust",
            "markdown"
          ]
        },
        "symbols": {
          "type": "array",
          "items": { "type": "string" },
          "description": "涉及的符号列表"
        },
        "summary": {
          "type": "string",
          "description": "内容摘要（外部文档）"
        },
        "key_points": {
          "type": "array",
          "items": { "type": "string" },
          "description": "关键要点（外部文档）"
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "元数据",
      "required": ["collected_at", "tool_used"],
      "properties": {
        "collected_at": {
          "type": "string",
          "format": "date-time",
          "description": "采集时间"
        },
        "tool_used": {
          "type": "string",
          "description": "使用的检索工具",
          "examples": [
            "auggie-mcp",
            "lsp:goToDefinition",
            "lsp:findReferences",
            "lsp:incomingCalls",
            "glob",
            "grep",
            "exa:search",
            "read"
          ]
        },
        "query": {
          "type": "string",
          "description": "检索查询"
        },
        "relevance_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "相关性评分"
        },
        "confidence": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "description": "置信度"
        }
      }
    },
    "relations": {
      "type": "object",
      "description": "关联关系",
      "properties": {
        "requirements": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^(FR|NFR|UX)-[0-9]{3}$"
          },
          "description": "关联的需求 ID"
        },
        "parent_evidence": {
          "type": "string",
          "pattern": "^EVD-[0-9]{3}$",
          "description": "父证据 ID"
        },
        "child_evidences": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^EVD-[0-9]{3}$"
          },
          "description": "子证据 ID 列表"
        },
        "related_evidences": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^EVD-[0-9]{3}$"
          },
          "description": "相关证据 ID 列表"
        }
      }
    },
    "validation": {
      "type": "object",
      "description": "验证状态",
      "properties": {
        "verified": {
          "type": "boolean",
          "default": false,
          "description": "是否已验证"
        },
        "verified_by": {
          "type": "string",
          "description": "验证者"
        },
        "verified_at": {
          "type": "string",
          "format": "date-time",
          "description": "验证时间"
        },
        "notes": {
          "type": "string",
          "description": "验证备注"
        }
      }
    }
  },
  "examples": [
    {
      "id": "EVD-001",
      "type": "code",
      "category": "implementation",
      "source": {
        "file": "src/services/auth.ts",
        "line_start": 42,
        "line_end": 58,
        "repository": "my-project",
        "commit": "abc1234"
      },
      "content": {
        "snippet": "export async function validateToken(token: string): Promise<TokenPayload> {\n  const decoded = jwt.verify(token, SECRET_KEY);\n  return decoded as TokenPayload;\n}",
        "language": "typescript",
        "symbols": ["validateToken", "TokenPayload", "jwt", "SECRET_KEY"]
      },
      "metadata": {
        "collected_at": "2024-01-19T10:00:00Z",
        "tool_used": "lsp:goToDefinition",
        "query": "validateToken",
        "relevance_score": 0.95,
        "confidence": "high"
      },
      "relations": {
        "requirements": ["FR-001", "NFR-002"],
        "child_evidences": ["EVD-002", "EVD-003"]
      },
      "validation": {
        "verified": true,
        "verified_by": "claude",
        "verified_at": "2024-01-19T10:05:00Z"
      }
    }
  ]
}
