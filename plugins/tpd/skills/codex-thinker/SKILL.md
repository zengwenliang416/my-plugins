---
name: codex-thinker
description: |
  ã€è§¦å‘æ¡ä»¶ã€‘thinking å·¥ä½œæµ Phase 3ï¼šä½¿ç”¨ Codex-CLI è¿›è¡Œæ·±åº¦æ¨ç†
  ã€æ ¸å¿ƒäº§å‡ºã€‘è¾“å‡º ${run_dir}/codex-thought.mdï¼ŒåŒ…å« Codex çš„æ¨ç†è¿‡ç¨‹å’Œç»“è®º
  ã€ä¸è§¦å‘ã€‘Light æ¨¡å¼ï¼ˆé™¤éæŒ‡å®š --parallelï¼‰
  ã€å…ˆé—®ä»€ä¹ˆã€‘æ— éœ€è¯¢é—®ï¼Œè‡ªåŠ¨æ‰§è¡Œ
  ã€ğŸš¨ å¼ºåˆ¶ã€‘å¿…é¡»ä½¿ç”¨ codeagent-wrapper codex å‘½ä»¤
allowed-tools:
  - Read
  - Write
  - Bash
  - mcp__sequential-thinking__sequentialthinking
arguments:
  - name: run_dir
    type: string
    required: true
    description: è¿è¡Œç›®å½•è·¯å¾„
  - name: level
    type: string
    required: true
    description: æ¨ç†å¼ºåº¦ (low/high)
---

# Codex Thinker - Codex æ¨ç†åŸå­æŠ€èƒ½

## MCP å·¥å…·é›†æˆ

| MCP å·¥å…·              | ç”¨é€”                         | è§¦å‘æ¡ä»¶        |
| --------------------- | ---------------------------- | --------------- |
| `sequential-thinking` | è§„åˆ’æ¨ç†ç­–ç•¥ï¼Œç»“æ„åŒ–è¾“å‡ºå¤„ç† | ğŸš¨ æ¯æ¬¡æ‰§è¡Œå¿…ç”¨ |

## å¤–éƒ¨å·¥å…·é›†æˆ

| å¤–éƒ¨å·¥å…·            | ç”¨é€”                    | è§¦å‘æ¡ä»¶              |
| ------------------- | ----------------------- | --------------------- |
| `codeagent-wrapper` | è°ƒç”¨ Codex è¿›è¡Œæ·±åº¦æ¨ç† | ğŸš¨ æ ¸å¿ƒæ‰§è¡Œï¼Œä¸å¯è·³è¿‡ |

## èŒè´£è¾¹ç•Œ

- **è¾“å…¥**: ç”¨æˆ·é—®é¢˜ï¼ˆä» `${run_dir}/input.md` è¯»å–ï¼‰
- **è¾“å‡º**: `${run_dir}/codex-thought.md`
- **æ ¸å¿ƒèƒ½åŠ›**: æŠ€æœ¯æ¨ç†ã€ä»£ç é€»è¾‘åˆ†æã€å®‰å…¨å®¡æŸ¥
- **å†™å…¥èŒƒå›´**: ä»…å…è®¸å†™å…¥ `${run_dir}`ï¼ˆä½äº OpenSpec äº§ç‰©ç›®å½•ï¼‰ï¼Œç¦æ­¢ä¿®æ”¹é¡¹ç›®ä¸šåŠ¡ä»£ç ä¸å…¶ä»– OpenSpec è§„èŒƒ

---

## ğŸš¨ CRITICAL: å¼ºåˆ¶å·¥å…·ä½¿ç”¨è§„åˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Codex æ¨ç†                                                   â”‚
â”‚     âœ… å¿…é¡»ä½¿ç”¨: ~/.claude/bin/codeagent-wrapper codex          â”‚
â”‚     âœ… å¿…é¡»ä½¿ç”¨: mcp__sequential-thinking__sequentialthinking   â”‚
â”‚     âŒ ç¦æ­¢è¡Œä¸º: è‡ªå·±æ¨¡æ‹Ÿ Codex è¾“å‡ºã€è·³è¿‡ Bash å‘½ä»¤            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Codex æ¨ç†æ¨¡å¼è¯´æ˜

| Level | æ¨¡å‹é…ç½®            | é€‚ç”¨åœºæ™¯               | Token é¢„ç®— |
| ----- | ------------------- | ---------------------- | ---------- |
| low   | o4-mini + standard  | ä¸­ç­‰å¤æ‚åº¦æ¨ç†         | ~8k        |
| high  | o3 + high reasoning | å¤æ‚æ¶æ„ã€æ·±åº¦ä»£ç åˆ†æ | ~32k       |

---

## æ‰§è¡Œæµç¨‹

### Step 0: ç»“æ„åŒ–æ¨ç†è§„åˆ’ï¼ˆsequential-thinkingï¼‰

ğŸš¨ **å¿…é¡»é¦–å…ˆä½¿ç”¨ sequential-thinking è§„åˆ’æ¨ç†ç­–ç•¥**

```
mcp__sequential-thinking__sequentialthinking({
  thought: "è§„åˆ’ Codex æ¨ç†ç­–ç•¥ã€‚éœ€è¦ï¼š1) è¯»å–é—®é¢˜ 2) æ„å»º Codex æç¤ºè¯ 3) æ‰§è¡Œ codeagent-wrapper 4) è§£æè¾“å‡º 5) æ ¼å¼åŒ–ä¿å­˜",
  thoughtNumber: 1,
  totalThoughts: 5,
  nextThoughtNeeded: true
})
```

**æ€è€ƒæ­¥éª¤**ï¼š

1. **é—®é¢˜è¯»å–**ï¼šè·å–åŸå§‹é—®é¢˜å†…å®¹
2. **æç¤ºè¯æ„å»º**ï¼šæ ¹æ® level é€‰æ‹©æç¤ºè¯æ¨¡æ¿
3. **Codex æ‰§è¡Œ**ï¼šè°ƒç”¨ codeagent-wrapper codex
4. **è¾“å‡ºè§£æ**ï¼šæå–æ¨ç†è¿‡ç¨‹å’Œæ ¸å¿ƒç»“è®º
5. **æ ¼å¼åŒ–ä¿å­˜**ï¼šå†™å…¥ codex-thought.md

### Step 1: è¯»å–é—®é¢˜

```
Read("${run_dir}/input.md")
```

### Step 2: è°ƒç”¨ Codex æ¨ç†

**Low Levelï¼ˆä¸­ç­‰æ·±åº¦ï¼‰**ï¼š

```bash
~/.claude/bin/codeagent-wrapper codex --prompt "
ä½ æ˜¯ä¸€ä½èµ„æ·±æŠ€æœ¯ä¸“å®¶ã€‚è¯·å¯¹ä»¥ä¸‹é—®é¢˜è¿›è¡Œæ·±åº¦æŠ€æœ¯åˆ†æï¼š

é—®é¢˜ï¼š${QUESTION}

åªè¾“å‡ºåˆ†æç»“è®ºï¼Œç¦æ­¢ç”Ÿæˆä»£ç /è¡¥ä¸æˆ–ä¿®æ”¹ä»»ä½•é¡¹ç›®æ–‡ä»¶ã€‚

è¯·ä»ä»¥ä¸‹è§’åº¦è¿›è¡Œæ¨ç†ï¼š
1. æŠ€æœ¯å¯è¡Œæ€§åˆ†æ
2. å®ç°è·¯å¾„æ¨å¯¼
3. æ½œåœ¨é£é™©è¯†åˆ«
4. æœ€ä½³å®è·µå»ºè®®

è¯·å±•ç¤ºä½ çš„æ¨ç†è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ï¼š
- æ¯ä¸€æ­¥çš„é€»è¾‘æ¨å¯¼
- å…³é”®å‡è®¾è¯´æ˜
- ç½®ä¿¡åº¦è¯„ä¼°
"
```

**High Levelï¼ˆæœ€å¤§æ·±åº¦ï¼‰**ï¼š

```bash
~/.claude/bin/codeagent-wrapper codex --prompt "
ä½ æ˜¯ä¸€ä½é¡¶çº§ç³»ç»Ÿæ¶æ„å¸ˆã€‚è¯·å¯¹ä»¥ä¸‹å¤æ‚é—®é¢˜è¿›è¡Œå…¨é¢æ·±åº¦åˆ†æï¼š

é—®é¢˜ï¼š${QUESTION}

åªè¾“å‡ºåˆ†æç»“è®ºï¼Œç¦æ­¢ç”Ÿæˆä»£ç /è¡¥ä¸æˆ–ä¿®æ”¹ä»»ä½•é¡¹ç›®æ–‡ä»¶ã€‚

è¯·è¿›è¡Œä»¥ä¸‹å±‚æ¬¡çš„æ¨ç†ï¼š

## ç¬¬ä¸€å±‚ï¼šé—®é¢˜åˆ†è§£
- è¯†åˆ«æ ¸å¿ƒé—®é¢˜å’Œå­é—®é¢˜
- å»ºç«‹é—®é¢˜ä¹‹é—´çš„ä¾èµ–å…³ç³»
- ç¡®å®šè§£å†³é¡ºåº

## ç¬¬äºŒå±‚ï¼šæ–¹æ¡ˆæ¢ç´¢
- ç”Ÿæˆè‡³å°‘ 3 ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ
- åˆ†ææ¯ç§æ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹
- è¯„ä¼°æŠ€æœ¯å¤æ‚åº¦å’Œé£é™©

## ç¬¬ä¸‰å±‚ï¼šæ·±åº¦æ¨ç†
- é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆ
- è¯¦ç»†æ¨å¯¼å®ç°æ­¥éª¤
- éªŒè¯é€»è¾‘å®Œæ•´æ€§

## ç¬¬å››å±‚ï¼šå®‰å…¨ä¸æ€§èƒ½
- å®‰å…¨é£é™©åˆ†æ
- æ€§èƒ½ç“¶é¢ˆé¢„æµ‹
- å¯æ‰©å±•æ€§è¯„ä¼°

è¯·å±•ç¤ºå®Œæ•´çš„æ¨ç†é“¾ï¼ŒåŒ…æ‹¬å‡è®¾ã€æ¨å¯¼å’Œç»“è®ºã€‚
"
```

### Step 3: è§£æå¹¶ä¿å­˜ç»“æœ

**è¾“å‡ºè·¯å¾„**ï¼š`${run_dir}/codex-thought.md`

**æ–‡æ¡£æ¨¡æ¿**ï¼š

```markdown
---
generated_at: { ISO 8601 æ—¶é—´æˆ³ }
model: codex-cli
level: { low / high }
session_id: { Codex ä¼šè¯ ID }
---

# Codex æ¨ç†è¾“å‡º

## é—®é¢˜åŸæ–‡

{é—®é¢˜å†…å®¹}

## æ¨ç†é…ç½®

- **æ¨ç†ç­‰çº§**: { low / high }
- **æ¨¡å‹**: { o4-mini / o3 }
- **æ‰§è¡Œæ—¶é—´**: { ç§’æ•° }s

## æ¨ç†è¿‡ç¨‹

### é—®é¢˜ç†è§£

{Codex å¯¹é—®é¢˜çš„ç†è§£}

### æ¨ç†æ­¥éª¤

{Codex çš„æ¨ç†æ­¥éª¤ï¼Œä¿æŒåŸå§‹æ ¼å¼}

### å…³é”®å‡è®¾

{æ¨ç†è¿‡ç¨‹ä¸­çš„å‡è®¾}

### æ ¸å¿ƒç»“è®º

{Codex çš„æ ¸å¿ƒç»“è®º}

## ç½®ä¿¡åº¦è¯„ä¼°

- **æ•´ä½“ç½®ä¿¡åº¦**: { é«˜ / ä¸­ / ä½ }
- **ä¸ç¡®å®šç‚¹**: { åˆ—è¡¨ }

## åŸå§‹è¾“å‡º
```

{Codex åŸå§‹è¿”å›å†…å®¹}

```

```

---

## é”™è¯¯å¤„ç†

### Codex è°ƒç”¨å¤±è´¥

```bash
# é‡è¯•ä¸€æ¬¡
~/.claude/bin/codeagent-wrapper codex --prompt "..." --retry

# å¦‚æœä»ç„¶å¤±è´¥ï¼Œè®°å½•é”™è¯¯å¹¶ç»§ç»­
echo "Codex è°ƒç”¨å¤±è´¥: ${ERROR}" > "${run_dir}/codex-thought.md"
```

### è¶…æ—¶å¤„ç†

```bash
# è®¾ç½®è¶…æ—¶ï¼ˆhigh level 3 åˆ†é’Ÿï¼Œlow level 1 åˆ†é’Ÿï¼‰
timeout ${TIMEOUT}s ~/.claude/bin/codeagent-wrapper codex --prompt "..."
```

---

## è´¨é‡é—¨æ§

### å·¥å…·ä½¿ç”¨éªŒè¯

- [ ] è°ƒç”¨äº† `mcp__sequential-thinking__sequentialthinking` è‡³å°‘ 1 æ¬¡
- [ ] è°ƒç”¨äº† `codeagent-wrapper codex` å‘½ä»¤
- [ ] äº§å‡º codex-thought.md æ–‡ä»¶

### äº§å‡ºè´¨é‡éªŒè¯

- [ ] åŒ…å«æ¨ç†è¿‡ç¨‹
- [ ] åŒ…å«æ ¸å¿ƒç»“è®º
- [ ] åŒ…å«ç½®ä¿¡åº¦è¯„ä¼°
- [ ] åŸå§‹è¾“å‡ºå·²ä¿å­˜

---

## è¿”å›å€¼

æˆåŠŸæ—¶è¿”å›ï¼š

```json
{
  "status": "success",
  "output_file": "${run_dir}/codex-thought.md",
  "level": "high",
  "execution_time": 45.2,
  "confidence": "high",
  "key_conclusions": ["ç»“è®º 1", "ç»“è®º 2"]
}
```

å¤±è´¥æ—¶è¿”å›ï¼š

```json
{
  "status": "error",
  "error_type": "timeout",
  "message": "Codex æ¨ç†è¶…æ—¶",
  "fallback": "ç»§ç»­ä½¿ç”¨å…¶ä»–æ¨¡å‹ç»“æœ"
}
```

---

## çº¦æŸ

- å¿…é¡»ä½¿ç”¨ codeagent-wrapper codex å‘½ä»¤
- å¿…é¡»ä½¿ç”¨ sequential-thinking è§„åˆ’æ‰§è¡Œç­–ç•¥
- å¿…é¡»ä¿å­˜åŸå§‹è¾“å‡º
- è¶…æ—¶åä¸é˜»å¡å·¥ä½œæµ
- high level æœ€å¤§ç­‰å¾… 3 åˆ†é’Ÿ
