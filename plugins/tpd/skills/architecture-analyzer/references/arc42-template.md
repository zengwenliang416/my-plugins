# arc42 架构文档模板

## 概述

arc42 是一个轻量级架构文档模板，由 12 个部分组成，适用于各种系统和技术栈。

## 12 部分结构

### 1. 引言和目标（Introduction and Goals）

**内容**：

- 需求概述
- 质量目标
- 利益相关者

**模板**：

```markdown
## 1. 引言和目标

### 1.1 需求概述

[系统的核心功能和业务目标]

### 1.2 质量目标

| 优先级 | 质量属性 | 场景描述             |
| ------ | -------- | -------------------- |
| 1      | 性能     | API 响应时间 < 200ms |
| 2      | 安全性   | 所有敏感数据加密存储 |
| 3      | 可用性   | 99.9% 可用率         |

### 1.3 利益相关者

| 角色     | 期望         | 联系方式 |
| -------- | ------------ | -------- |
| 产品经理 | 功能完整性   | -        |
| 开发团队 | 代码可维护性 | -        |
| 运维团队 | 部署简便性   | -        |
```

### 2. 约束（Constraints）

**内容**：

- 技术约束
- 组织约束
- 惯例约束

**模板**：

```markdown
## 2. 约束

### 2.1 技术约束

| ID   | 约束            | 原因           |
| ---- | --------------- | -------------- |
| TC-1 | 使用 TypeScript | 团队技术栈统一 |
| TC-2 | 支持 PostgreSQL | 现有基础设施   |

### 2.2 组织约束

| ID   | 约束         | 原因         |
| ---- | ------------ | ------------ |
| OC-1 | 2 周迭代周期 | 敏捷流程要求 |

### 2.3 惯例约束

| ID   | 约束             | 原因     |
| ---- | ---------------- | -------- |
| CC-1 | RESTful API 设计 | 行业标准 |
```

### 3. 上下文和范围（Context and Scope）

**内容**：

- 业务上下文（Business Context）
- 技术上下文（Technical Context）

**模板**：

```markdown
## 3. 上下文和范围

### 3.1 业务上下文

[系统边界图 - 展示系统与外部参与者的关系]

| 外部实体   | 输入     | 输出     |
| ---------- | -------- | -------- |
| 用户       | 请求     | 响应数据 |
| 第三方支付 | 支付结果 | 支付请求 |

### 3.2 技术上下文

[技术边界图 - 展示技术组件和通信协议]

| 组件   | 协议  | 说明        |
| ------ | ----- | ----------- |
| 前端   | HTTPS | React SPA   |
| 后端   | REST  | Node.js API |
| 数据库 | TCP   | PostgreSQL  |
```

### 4. 解决方案策略（Solution Strategy）

**内容**：

- 技术决策
- 组织决策
- 架构模式

**模板**：

```markdown
## 4. 解决方案策略

### 4.1 技术决策

| 决策       | 选择       | 理由               |
| ---------- | ---------- | ------------------ |
| 前端框架   | React      | 生态成熟、团队熟悉 |
| 后端运行时 | Node.js    | 全栈 JavaScript    |
| 数据库     | PostgreSQL | 关系型需求、ACID   |

### 4.2 架构模式

- **分层架构**：Controller → Service → Repository
- **领域驱动设计**：核心业务逻辑封装
- **事件驱动**：异步处理长耗时任务
```

### 5. 构建块视图（Building Block View）

**内容**：

- 白盒视图（整体系统分解）
- 黑盒视图（各构建块描述）

**模板**：

```markdown
## 5. 构建块视图

### 5.1 Level 1: 系统白盒

[组件图 - 展示主要模块]

| 模块           | 职责           | 技术        |
| -------------- | -------------- | ----------- |
| API Gateway    | 请求路由、认证 | Express     |
| Auth Service   | 用户认证授权   | Passport.js |
| Business Logic | 核心业务处理   | Custom      |

### 5.2 Level 2: 模块白盒

[各模块内部结构详细描述]
```

### 6. 运行时视图（Runtime View）

**内容**：

- 关键场景的运行时行为
- 序列图、活动图

**模板**：

```markdown
## 6. 运行时视图

### 6.1 用户登录场景

\`\`\`mermaid
sequenceDiagram
participant U as User
participant F as Frontend
participant A as Auth API
participant D as Database

    U->>F: 输入凭据
    F->>A: POST /auth/login
    A->>D: 查询用户
    D-->>A: 用户数据
    A-->>F: JWT Token
    F-->>U: 登录成功

\`\`\`

### 6.2 数据处理场景

[其他关键场景的时序图]
```

### 7. 部署视图（Deployment View）

**内容**：

- 基础设施
- 部署拓扑

**模板**：

```markdown
## 7. 部署视图

### 7.1 基础设施

| 环境 | 提供商 | 配置           |
| ---- | ------ | -------------- |
| 开发 | Local  | Docker Compose |
| 测试 | AWS    | ECS Fargate    |
| 生产 | AWS    | ECS + RDS      |

### 7.2 部署拓扑

\`\`\`mermaid
graph TB
subgraph "AWS Cloud"
ALB[Application Load Balancer]
subgraph "ECS Cluster"
API[API Service]
Worker[Worker Service]
end
RDS[(PostgreSQL RDS)]
Redis[(ElastiCache)]
end
ALB --> API
API --> RDS
API --> Redis
Worker --> RDS
\`\`\`
```

### 8. 横切关注点（Crosscutting Concepts）

**内容**：

- 安全
- 日志
- 错误处理
- 持久化
- 通信

**模板**：

```markdown
## 8. 横切关注点

### 8.1 安全

| 层面 | 措施                 |
| ---- | -------------------- |
| 传输 | HTTPS/TLS 1.3        |
| 认证 | JWT + Refresh Token  |
| 授权 | RBAC                 |
| 数据 | AES-256 加密敏感字段 |

### 8.2 日志

| 级别  | 用途     | 示例           |
| ----- | -------- | -------------- |
| ERROR | 异常情况 | 数据库连接失败 |
| WARN  | 潜在问题 | API 响应缓慢   |
| INFO  | 业务事件 | 用户登录成功   |
| DEBUG | 调试信息 | 请求参数       |

### 8.3 错误处理

- 统一错误响应格式
- 区分业务错误和系统错误
- 错误堆栈不暴露给客户端

### 8.4 持久化

- ORM: Prisma
- 迁移策略: 版本化迁移脚本
- 备份策略: 每日自动备份
```

### 9. 架构决策（Architecture Decisions）

**内容**：

- ADR（Architecture Decision Records）

**模板**：

```markdown
## 9. 架构决策

### ADR-001: 使用 JWT 进行认证

**状态**: 已接受

**上下文**: 需要无状态的认证方案

**决策**: 使用 JWT + Refresh Token

**后果**:

- ✅ 无状态，易于水平扩展
- ✅ 跨服务认证方便
- ⚠️ Token 无法主动撤销
- 📝 需要实现 Token 黑名单（可选）

### ADR-002: 数据库选型

[其他架构决策记录]
```

### 10. 质量需求（Quality Requirements）

**内容**：

- 质量树
- 质量场景

**模板**：

```markdown
## 10. 质量需求

### 10.1 质量树

\`\`\`
质量
├── 性能
│ ├── 响应时间
│ └── 吞吐量
├── 可用性
│ ├── 正常运行时间
│ └── 故障恢复
├── 安全性
│ ├── 认证
│ └── 数据保护
└── 可维护性
├── 可测试性
└── 可扩展性
\`\`\`

### 10.2 质量场景

| ID   | 质量属性 | 场景             | 度量           |
| ---- | -------- | ---------------- | -------------- |
| QS-1 | 性能     | 100 并发用户登录 | P99 < 500ms    |
| QS-2 | 可用性   | 数据库主节点故障 | 30s 内自动切换 |
```

### 11. 风险和技术债务（Risks and Technical Debt）

**内容**：

- 已识别的风险
- 技术债务清单

**模板**：

```markdown
## 11. 风险和技术债务

### 11.1 风险

| ID  | 风险              | 概率 | 影响 | 缓解措施       |
| --- | ----------------- | ---- | ---- | -------------- |
| R-1 | 第三方 API 不可用 | 中   | 高   | 实现熔断和降级 |
| R-2 | 数据迁移失败      | 低   | 高   | 回滚脚本和备份 |

### 11.2 技术债务

| ID   | 描述           | 优先级 | 计划修复 |
| ---- | -------------- | ------ | -------- |
| TD-1 | 缺少单元测试   | 高     | Sprint 3 |
| TD-2 | 日志格式不统一 | 中     | Sprint 4 |
```

### 12. 术语表（Glossary）

**内容**：

- 领域术语
- 技术术语

**模板**：

```markdown
## 12. 术语表

| 术语 | 定义                                          |
| ---- | --------------------------------------------- |
| JWT  | JSON Web Token，用于安全传输信息的开放标准    |
| RBAC | Role-Based Access Control，基于角色的访问控制 |
| ADR  | Architecture Decision Record，架构决策记录    |
```

## 使用指南

1. **必填部分**：1, 3, 4, 5, 8, 9
2. **推荐部分**：2, 6, 7, 10
3. **可选部分**：11, 12

根据项目规模和复杂度调整详细程度。
