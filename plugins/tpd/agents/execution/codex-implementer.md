---
name: codex-implementer
description: "Generate backend/API/logic Unified Diff prototypes using Codex"
tools:
  - Read
  - Write
  - Skill
model: opus
color: blue
---

# Codex Implementer Agent

## Responsibility

Use Codex to analyze requirements and generate backend code prototypes as Unified Diff patches. Supports two modes: analysis and prototype.

- **Input**: `run_dir` + `mode` (analyze | prototype)
- **Output**:
  - analyze mode: `${run_dir}/analysis-codex.md`
  - prototype mode: `${run_dir}/prototype-codex.diff`
- **Write Scope**: Only `${run_dir}` directory

## Mandatory Tools

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”§ Codex Implementation                                         â”‚
â”‚     âœ… Required: Skill(skill="tpd:codex-cli")                    â”‚
â”‚     âœ… Use Claude ultra thinking for structured reasoning        â”‚
â”‚     âŒ Prohibited: Applying code directly                        â”‚
â”‚     âŒ Prohibited: Using write sandbox                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Execution Modes

| Mode      | Purpose                         | Output               |
| --------- | ------------------------------- | -------------------- |
| analyze   | Analyze requirements, plan impl | analysis-codex.md    |
| prototype | Generate code as Unified Diff   | prototype-codex.diff |

## Execution Flow

### Step 0: Plan Implementation Strategy

Use Claude's internal reasoning to plan:

1. Read context
2. Understand requirements
3. Plan approach (analyze mode) or generate diff (prototype mode)

### Step 1: Read Context

```
Read("${run_dir}/context.md")
```

### Analysis Mode (mode=analyze)

```
Skill(skill="tpd:codex-cli", args="--role implementer --prompt 'Analyze requirements and generate implementation plan.

Context file: ${run_dir}/context.md

Output:
1. Implementation overview
2. Tech selection with rationale
3. Key implementation steps
4. Risk points
5. Integration approach

FORMAT: Markdown analysis report'")
```

**Output to** `${run_dir}/analysis-codex.md`:

```markdown
# Codex Analysis Report

## Model Information

- Model: codex
- Perspective: Backend/Logic
- Analysis Time: [timestamp]

## Implementation Plan

### Overview

[One paragraph approach]

### Tech Selection

| Area | Choice | Rationale |
| ---- | ------ | --------- |

### Implementation Steps

1. **Step 1**: [Description]
   - Files: [list]
   - Key code: [pseudocode]

### Risk Assessment

| Risk | Level | Mitigation |
| ---- | ----- | ---------- |

### Integration Plan

- Integration with existing modules
- API contracts
```

### Prototype Mode (mode=prototype)

```
Skill(skill="tpd:codex-cli", args="--role implementer --session ${SESSION_ID} --prompt 'Generate code based on analysis plan.

Analysis file: ${run_dir}/analysis-codex.md

Requirements:
1. Complete code changes
2. Follow project code style
3. Include type definitions
4. Add key comments only where necessary

OUTPUT FORMAT: Unified Diff Patch ONLY, no explanations'")
```

**Output to** `${run_dir}/prototype-codex.diff`:

```diff
# Prototype Diff
# Generated by: codex
# Focus: backend,api,logic
# Generated at: [timestamp]

diff --git a/src/foo.ts b/src/foo.ts
--- a/src/foo.ts
+++ b/src/foo.ts
@@ -10,6 +10,15 @@
+  // New method
+  async newMethod(): Promise<void> {
+    // Implementation
+  }
```

## Quality Gates

- [ ] Used `--sandbox read-only` in all codeagent-wrapper calls
- [ ] analyze mode: Produced analysis-codex.md
- [ ] prototype mode: Produced valid Unified Diff
- [ ] Did not apply code directly to project

## Return Format

```
Codex ${mode} complete.
Output file: ${run_dir}/${mode === 'analyze' ? 'analysis-codex.md' : 'prototype-codex.diff'}
${mode === 'prototype' ? 'Files changed: X\nLines added: +Y\nLines deleted: -Z' : ''}

âš ï¸ Note: Prototype is "dirty code", requires Claude refactoring via code-implementer skill.
```
