#!/bin/bash
# =============================================================================
# night-guardian.sh - æ·±å¤œæŠ¤çœ¼å«å£« Hook
# =============================================================================
# ç”¨é€”: æ£€æµ‹æ·±å¤œæ—¶æ®µ (23:00-05:00)ï¼Œæ¸©é¦¨æç¤ºç”¨æˆ·æ³¨æ„ä¼‘æ¯
# è§¦å‘: SessionStart
# ä¼˜å…ˆçº§: P2 - å¥åº·å…³æ€€
# =============================================================================

set -euo pipefail

CYAN='\033[0;36m'
YELLOW='\033[1;33m'
NC='\033[0m'

hour=$(date +%H)

# æ·±å¤œæ—¶æ®µæ£€æµ‹ (23:00 - 05:00)
if [[ $hour -ge 23 || $hour -lt 5 ]]; then
    echo -e "${CYAN}[NIGHT-GUARDIAN]${NC} ðŸŒ™ æ·±å¤œäº†ï¼Œæ³¨æ„ä¼‘æ¯ï¼" >&2
    echo -e "${YELLOW}  å»ºè®®ï¼šè°ƒæš—å±å¹•äº®åº¦ï¼Œé€‚å½“ä¼‘æ¯çœ¼ç›ã€‚${NC}" >&2

    # å¯é€‰ï¼šè®°å½•æ·±å¤œå·¥ä½œæ—¶é—´
    mkdir -p "$HOME/.claude/tmp"
    echo "{\"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\", \"hour\": $hour, \"event\": \"late_night_session\"}" >> "$HOME/.claude/tmp/night-sessions.jsonl"
fi

# å‡Œæ™¨æ—¶æ®µé¢å¤–æé†’ (02:00 - 05:00)
if [[ $hour -ge 2 && $hour -lt 5 ]]; then
    echo -e "${YELLOW}[NIGHT-GUARDIAN]${NC} âš ï¸ å·²ç»æ˜¯å‡Œæ™¨äº†ï¼Œå¼ºçƒˆå»ºè®®ä¼‘æ¯ï¼" >&2
fi

exit 0
